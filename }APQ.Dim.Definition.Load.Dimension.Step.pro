601,100
602,"}APQ.Dim.Definition.Load.Dimension.Step"
562,"CHARACTERDELIMITED"
586,"DimensionDefinitionTemplate.csv"
585,"DimensionDefinitionTemplate.csv"
564,
565,"qG\AqIKSCfoh7E`nNaZbBOaj6Fu0i81oU6s@SY=hd8gAC85KpLOg?yJ[?wn0QPZ_JU\Gd4lUUMjV:H`LF]FI8Y:XiU8K<o[[yH7SHxMk;eFnumnb3y:AV\NMoK\_\tfsebYHNlI<Gwqd;m?\0cIno9shpipXH6i49SX?@x6wG4bH1\Uz=tKBgDy8i6u=e04Eo8Tchz_2"
559,1
928,0
593,
594,
595,
597,
598,
596,
800,
801,
566,53
SELECT '' as Element, 
'' as Parent1, 
'' as Parent2, 
'' as Parent3, 
'' as Parent4, 
'' as Parent5, 
'' as Parent6, 
'' as Parent7, 
'' as Parent8, 
'' as Comment,
'' as Weight, 
'' as Type,
'' as Attribute1,
'' as Attribute2,
'' as Attribute3,
'' as Attribute4,
'' as Attribute5,
'' as Attribute6,
'' as Attribute7,
'' as Attribute8,
'' as Attribute9,
'' as Attribute10,
'' as Attribute11,
'' as Attribute12,
'' as Attribute13,
'' as Attribute14,
'' as Attribute15,
'' as Attribute16,
'' as Attribute17,
'' as Attribute18,
'' as Attribute19,
'' as Attribute20,
'' as Attribute21,
'' as Attribute22,
'' as Attribute23,
'' as Attribute24,
'' as Attribute25,
'' as Attribute26,
'' as Attribute27,
'' as Attribute28,
'' as Attribute29,
'' as Attribute30,
'' as Attribute31,
'' as Attribute32,
'' as Attribute33,
'' as Attribute34,
'' as Attribute35,
'' as Attribute36,
'' as Attribute37,
'' as Attribute38,
'' as Attribute39,
'' as Attribute40
FROM information_schema.tables
567,","
588,"."
589,","
568,""""
570,
571,
569,1
592,0
599,1000
560,5
pDoProcessLogging
pDimToBuild
pID
pSingleStep
pDebug
561,5
2
2
2
2
2
590,5
pDoProcessLogging,"1"
pDimToBuild,""
pID,""
pSingleStep,"0"
pDebug,"0"
637,5
pDoProcessLogging,"Record in process log"
pDimToBuild,"Pick the dimension hierarchy to load (dim:hier for specific alternate hierarchy)"
pID,"Step ID for the dimension loading"
pSingleStep,"Execute step independently?"
pDebug,"Debug 0=false 1=true"
577,86
v1
v2
v3
v4
v5
v6
v7
v8
v9
v10
v11
v12
v13
v14
v15
v16
v17
v18
v19
v20
v21
v22
v23
v24
v25
v26
v27
v28
v29
v30
v31
v32
v33
v34
v35
v36
v37
v38
v39
v40
v41
v42
v43
v44
v45
v46
v47
v48
v49
v50
v51
v52
v53
v54
v55
v56
v57
v58
v59
v60
v61
v62
v63
v64
v65
v66
v67
v68
v69
v70
v71
v72
v73
v74
v75
v76
v77
v78
v79
v80
v81
v82
v83
nValue
sValue
Value_is_String
578,86
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
2
1
2
1
579,86
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
580,86
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
581,86
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
582,86
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=32ColType=827
VarType=33ColType=827
VarType=32ColType=827
VarType=33ColType=827
603,0
572,475
##############################################################################################################
#Region - Header
# CUBEWISE APLIQODE FRAMEWORK VERSION 3.05
# Copyright Apliqo AG, a Cubewise Company. All rights reserved.
# This software and related documentation are provided under a license agreement containing restrictions on use and disclosure 
# and are protected by intellectual property laws. Except as expressly permitted in your license agreement or allowed by law, 
# you may not use, copy, reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish, 
# or display any part, in any form, or by any means.
##############################################################################################################################

#****Begin: Generated Statements***
#****End: Generated Statements****

##############################################################################################################
#Region @DOC
### PURPOSE:
### 	Build/Update a dimension hierarchy based on the informations stored in the cube }APQ Dimension Definition
### 	This TI is triggered from the TI }APQ.Dim.Definition.Load.Dimension which run throught the different steps.
### DATA SOURCE:
### 	Defined in the process according to the cube }APQ Dimension Definition
### INTENDED USAGE:
### 	Update a dimension hierarchy according to the source
#EndRegion @DOC
##############################################################################################################

##############################################################################################################
#Region - Initialize Logging
sThisProcName = GetProcessName();
### Params
sProcLogParams = Expand('pDimToBuild:%pDimToBuild% & pID:%pID% & pSingleStep:%pSingleStep% & pDebug:%pDebug%');
### Params
IF( pDoProcessLogging @= '1' ); IF( sProcLogParams @<> '' ); LogOutput( 'INFO', sThisProcName | ' run with parameters ' | sProcLogParams ); EndIF;
  cCubTgt = ''; sProcLogCube = '}APQ Process Execution Log'; sCubLogCube = '}APQ Cube Last Updated by Process'; nProcessStartTime = Now(); nProcessFinishTime = 0; nMetaDataRecordCount = 0; nDataRecordCount = 0;
  NumericGlobalVariable( 'PrologMinorErrorCount' );  PrologMinorErrorCount = 0; NumericGlobalVariable( 'MetadataMinorErrorCount' );  MetadataMinorErrorCount = 0; NumericGlobalVariable( 'DataMinorErrorCount' );  DataMinorErrorCount = 0; NumericGlobalVariable( 'ProcessReturnCode' );  ProcessReturnCode = 0;
  sProcessErrorLogFile = ''; sProcessRunBy = TM1User(); IF( DimIx( '}Clients', sProcessRunBy ) > 0 ); sProcessRunBy = IF( AttrS( '}Clients', sProcessRunBy, '}TM1_DefaultDisplayValue' ) @= '', sProcessRunBy, AttrS( '}Clients', sProcessRunBy, '}TM1_DefaultDisplayValue' ) ); EndIF;
  sLogYear = TimSt( nProcessStartTime, '\Y' ); sLogDay = TimSt( nProcessStartTime, '\m-\d' ); sLogMinute = TimSt( nProcessStartTime, '\h:\i' ); sLogSecond = TimSt( nProcessStartTime, '\s' ); IF( DimIx( '}APQ Processes', sThisProcName ) = 0 ); ExecuteProcess( '}APQ.Dim.ControlDimensionCopies.Update', 'pDoProcessLogging', pDoProcessLogging, 'pClear', '0' ); EndIF;
  nProcessExecutionIndex = CellGetN( sProcLogCube, 'Total APQ Time Year', 'Total Year', 'Total Day', 'Total Minute', sThisProcName, 'nProcessStartedFlag' ) + 1; nProcessExecutionIntraDayIndex = CellGetN( sProcLogCube, sLogYear, sLogDay, 'Total Day', 'Total Minute', sThisProcName, 'nProcessStartedFlag' ) + 1;
  sYear01 = sLogYear; sYear02 = sLogYear; sDay01 = sLogDay; sDay02 = 'D000'; sMinute01 = sLogMinute; sMinute02 = 'Total Day Entry'; sSecond01 = sLogSecond; sSecond02= 'Last Entry'; nCountTime = 1; nTotalLogTime = 2; 
  While ( nCountTime <= nTotalLogTime ); sLoggingYear = Expand( '%sYear' | NumberToStringEx( nCountTime, '00', '', '' ) | '%' ); sLoggingDay = Expand( '%sDay' | NumberToStringEx( nCountTime, '00', '', '' ) | '%' ); sLoggingMinute = Expand( '%sMinute' | NumberToStringEx( nCountTime, '00', '', '' ) | '%' ); sLoggingSecond = Expand( '%sSecond' | NumberToStringEx( nCountTime, '00', '', '' ) | '%' );
  CellPutN( nProcessStartTime, sProcLogCube, sLoggingYear, sLoggingDay, sLoggingMinute, sLoggingSecond, sThisProcName, 'nProcessStartTime' ); CellPutN( 1, sProcLogCube, sLoggingYear, sLoggingDay, sLoggingMinute, sLoggingSecond, sThisProcName, 'nProcessStartedFlag' );
  CellPutN( nProcessExecutionIndex, sProcLogCube, sLoggingYear, sLoggingDay, sLoggingMinute, sLoggingSecond, sThisProcName, 'nProcessExecutionIndex' ); CellPutN( nProcessExecutionIntraDayIndex, sProcLogCube, sLoggingYear, sLoggingDay, sLoggingMinute, sLoggingSecond, sThisProcName, 'nProcessExecutionIntraDayIndex' );
  CellPutS( sProcessRunBy, sProcLogCube, sLoggingYear, sLoggingDay, sLoggingMinute, sLoggingSecond, sThisProcName, 'sRunBy' ); CellPutS( sProcLogParams, sProcLogCube, sLoggingYear, sLoggingDay, sLoggingMinute, sLoggingSecond, sThisProcName, 'sParams' ); nCountTime = nCountTime + 1; End;
EndIF; IF( CellGetN( '}APQ Process Parallelization Control', sThisProcName, 'Disabled' ) <> 0 ); ProcessQuit; EndIF;
#EndRegion - Initialize Logging
##############################################################################################################
#EndRegion - Header
##############################################################################################################

##############################################################################################################
#Region - Declare Constants
cCubParam       = '}APQ Settings';
cLoggingLoc     = GetProcessErrorFileDirectory;
cDebugLoc       = CellGetS( cCubParam, 'Location: Debugging', 'String' );
cDebugLoc       = cDebugLoc | IF( SubSt( cDebugLoc, Long( cDebugLoc ), 1 ) @<> '\', '\', '' );
cDebugFile      = cDebugLoc | sThisProcName |'_'| TimSt( Now(), '\Y\m\d\h\i\s' );
sDebugFile      = cDebugFile | '_Prolog.log';
nDebug          = StringToNumber( pDebug );
cTestVal1       = CellGetS( cCubParam, 'Customer Key', 'String' );
cTestVal2       = DimNm( '}APQ Escape Characters', 1 );
cTestVal3       = CellGetS( cCubParam, 'Customer Name', 'String' );
cBlankVal       = CellGetS( cCubParam, 'Replace with blank value', 'String' );
sTimeStamp      = TimSt( Now, '\Y\m\d\h\i\s' );
sRandomInt      = NumberToString( INT( RAND( ) * 1000 ));
cViewSrcPrefix  = CellGetS( cCubParam, 'Std Datasource View Prefix', 'String' );
cViewSrc        = cViewSrcPrefix | sThisProcName |'_'| sTimeStamp |'_'| sRandomInt;
cSubSrc         = cViewSrc;
cCubSrc         = '}APQ Dimension Definition Source';
sDelimList      = CellGetS( cCubParam, 'pDelim', 'String' );
sDelimDim       = CellGetS( cCubParam, 'pDimDelim', 'String' );
# can't use the default ':' as could be an alternate hierarchy
sDelimEleStart  = '|';
sDelimEle       = CellGetS( cCubParam, 'pEleDelim', 'String' );

nErr            = 0;
sErr            = '';
sValue          = '';
nValue          = 0;
Value_is_String = 0;

DatasourceASCIIQuoteCharacter   = CellGetS( cCubParam, 'DatasourceASCIIQuoteCharacter', 'String' );
DatasourceASCIIDelimiter        = CellGetS( cCubParam, 'DatasourceASCIIDelimiter', 'String' );
#EndRegion - Declare Constants
##############################################################################################################

##############################################################################################################
#Region - Test parameters
IF( pDebug @>= '1' );

  # Log start time
  AsciiOutput( sDebugFile, 'Process Started: ' | TimSt( Now, CellGetS('}APQ Settings', 'Date Time format','String') ) );

  # Log parameters
  AsciiOutput( sDebugFile, 'Parameters:' );
  AsciiOutput( sDebugFile, 'pDimToBuild: ' | pDimToBuild );
  AsciiOutput( sDebugFile, 'pID: ' | pID );
  AsciiOutput( sDebugFile, '' );

EndIF;

#Parameter Check
IF( DIMIX( '}APQ Dimension Hierarchies', pDimToBuild ) = 0 );
   nErr = nErr + 1;
   IF( sErr @<> '' ); sErr = sErr | ' & '; EndIF;
   sErr = 'Invalid dimension or hierarchy name:' | pDimToBuild;
ELSEIF( Scan( ':', pDimToBuild ) > 0 );
   # if same named hierarchy then convert tp base dimension name
   IF( SubSt( pDimToBuild, 1, Scan( ':', pDimToBuild ) - 1 ) @= Trim( SubSt( pDimToBuild, Scan( ':', pDimToBuild ) + 1, Long( pDimToBuild ) ) ) );
       pDimToBuild = SubSt( pDimToBuild, 1, Scan( ':', pDimToBuild ) - 1 );
   ENDIF;
ENDIF;

IF( DIMIX( '}APQ Item Index', pID ) = 0 );
   nErr = nErr + 1;
   IF( sErr @<> '' ); sErr = sErr | ' & '; EndIF;
   sErr = 'Invalid ID in the Item Index:' | pID;
ELSE;
   pID = DimensionElementPrincipalName( '}APQ Item Index', pID );
ENDIF;

bSingleStep = If( pSingleStep @= '1', 1, 0 );

######################
### If parameters fail validation then set data source to NULL and either proceed to Epilog or quit process

IF( nErr > 0 );
   IF( pDebug @>= '1' );
      AsciiOutput( sDebugFile, 'Validation tests failed with messages: ' | sErr );
   EndIF;
   DataSourceType = 'NULL';
   ItemReject( sErr );
EndIF;
#EndRegion - Test parameters
##############################################################################################################

##############################################################################################################
#Region - Prolog variables
# Logging variables
cDateFormat         = '\d/\m/\Y - \h:\i:\s';
cDurationFormat     = '\h:\i:\s';
nStartTime          = NOW();
sStartTime          = TIMST( nStartTime , cDateFormat );

#Core variables
sSysDimensionCube   = '}APQ Dimension Definition';
cDimPropertyCube    = '}DimensionProperties';
sSysDimParameter    = '}APQ Dimension Definition Parameter';
cProcessLauncherPro = 'APQ.Process.Execute';
cAttrDBCube         = '}APQ Dimension Attribute Definition';
cAttrDBDim          = '}APQ Dimension Attributes';
sMyUser             = TM1User();
IF( DimIx( '}Clients', sMyUser ) > 0 );
	sMyUser         = IF( AttrS( '}Clients', sMyUser, '}TM1_DefaultDisplayValue' ) @= '', sMyUser, AttrS( '}Clients', sMyUser, '}TM1_DefaultDisplayValue' ) );
EndIF;
iMaxAttributes      = ElCompN( sSysDimParameter , 'Attributes' ) - 1;
iMaxParent          = 8;
nDimClone           = 0;
nSourceIsProc       = 0;
nRecordCount        = 0;

# Variables from cube
nRebuidMode 	    = IF( CellGetS(sSysDimensionCube, pDimToBuild, 'Total Items', 'Dimension Delete All Elements', 'String' ) @= 'Y', 1, 0 );
nAttrRefreshMode 	= IF( CellGetS( sSysDimensionCube, pDimToBuild, 'Total Items', 'Delete And Recreate All Attributes', 'String' ) @= 'Y', 1, 0 );
nUnwindMode 	    = IF( CellGetS(sSysDimensionCube, pDimToBuild, 'Total Items', 'Dimension Unwind', 'String' ) @= 'Y', 1, 0 );
sUnwindConso 	    = CellGetS( sSysDimensionCube, pDimToBuild, 'Total Items', 'Unwind Consolidation List','String' );
sUnwindConsoSep	    = CellGetS( sSysDimensionCube, pDimToBuild, 'Total Items', 'Unwind Consolidation List Separator','String' );
nUnwindRecursive	= IF( CellGetS( sSysDimensionCube, pDimToBuild, 'Total Items', 'Unwind Recursively','String' ) @= 'Y', 1, 0 );
sDelimEle           = CellGetS( cCubParam, 'pEleDelim', 'String' );
sDelimEle           = IF( sDelimEle @= '', '+', sDelimEle );
sUnwindConsoSep     = IF( sUnwindConsoSep @= '', sDelimEle, sUnwindConsoSep );
If( sUnwindConso    @<> '' );
    If( Scan( sUnwindConsoSep, sUnwindConso ) = 0 );
        sUnwindConso = sUnwindConso | sUnwindConsoSep;
    EndIf;
EndIf;
nAllowNtoC          = IF( CellGetS( sSysDimensionCube, pDimToBuild, 'Total Items', 'Allow N to C element type conversion','String' ) @= 'Y', 1, 0 );
nLoadAttrIndirectly = IF( CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Load Attrs First To Framework','String' ) @= 'Y', 1, 0 );
nAliasAsElement     = IF( CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Allow alias in place of element names', 'String' ) @= 'Y', 1, 0 );
sMyDimension 	    = CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Dimension To Build', 'String' );
sFinalDimension 	= CellGetS( sSysDimensionCube, pDimToBuild, 'Total Items', 'Dimension To Build', 'String' );
nNewTemplate        = IF( CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Template Type', 'String' ) @= 'ByRollup', 1, 0 );
nSteps              = CellGetN( sSysDimensionCube, pDimToBuild, 'Total Items', 'Dimension To Build', 'Count' );
sODBCSource	        = '';
sSourceFileName	    = '';

# Check for step (data source) running independently
If( bSingleStep     = 1 );
    # don't update temp dimension, perform update directly on final target dimension
    sMyDimension    = sFinalDimension;
    If( nSteps      > 1 );
        # if multiple steps and running in single step mode DISABLE the global element clearing, attribute clearing and unwind options
        nRebuidMode = 0;
        nAttrRefreshMode = 0;
        nUnwindMode = 0;
    EndIf;
EndIf;

NumericGlobalVariable( 'PrologMinorErrorCount' );
NumericGlobalVariable( 'MetadataMinorErrorCount' );
NumericGlobalVariable( 'DataMinorErrorCount' );

# Log the start time
CellPutS( sStartTime, sSysDimensionCube, pDimToBuild, pID, 'Last Update Start Time', 'String' );
CellPutS( sMyUser, sSysDimensionCube, pDimToBuild, pID, 'User', 'String' );

# Attribute framework
IF( nLoadAttrIndirectly = 1 );
    AttrPutS( 'TRUE', '}APQ Dimensions', AttrS( '}APQ Dimension Hierarchies', pDimToBuild, 'Dimension' ), 'ATTR_FRAMEWORK' );
ENDIF;
#EndRegion - Prolog variables
##############################################################################################################

##############################################################################################################
#Region - Define the DataSource (Type, Source Name and Query)
sSourceType = CellGetS(sSysDimensionCube ,pDimToBuild, pID,'Source Type','String') ;
IF( sSourceType @= 'ODBC' );
	# Local Variable Definition
	sODBCSource         = CellGetS( sSysDimensionCube, pDimToBuild, pID, 'ODBC Source', 'String' );
	sSQLQuery           = CellGetS( sSysDimensionCube, pDimToBuild, pID, 'SQL Query', 'String' );
	sSourceSyst         = sODBCSource;

	# Source definition for the ODBC
	DataSourceType		= 'ODBC';
	DatasourceNameForServer	= CellGetS( cCubParam, sODBCSource, 'String' );
	DatasourceUsername	= CellGetS( cCubParam, sODBCSource | ' User', 'String' );
	DatasourcePassword	= CellGetS( cCubParam, sODBCSource | ' Pwd', 'String' );
	DatasourceQuery		= sSQLQuery;

ELSEIF( sSourceType @= 'CSV' );
	# Get the file folder and define the trailing '\'
	sSourceFolder 	    = CellGetS( sSysDimensionCube, pDimToBuild, pID, 'CSV File Folder', 'String' );
	sSourceFolder 	    = IF( SUBST( sSourceFolder, Long( sSourceFolder ), 1 ) @<> '\' & sSourceFolder @<> '' , sSourceFolder | '\', sSourceFolder );
	sSourceFileName 	= CellGetS( sSysDimensionCube, pDimToBuild, pID, 'CSV File Name', 'String' );
	sSourceSyst         = sSourceFileName;

	# Source definition for the Text File
	DataSourceType		='CHARACTERDELIMITED';
	DatasourceNameForServer = sSourceFolder | sSourceFileName;
	DatasourceASCIIHeaderRecords = 1;

ELSEIF( sSourceType @= 'CUBE' );
	# source view from dimension definition source cube. Can't use : as bedrock delimiter
	If( nNewTemplate    = 1 );
	    sFilter         = Expand('}APQ Dimension Hierarchies%sDelimEleStart%%sFinalDimension%%sDelimDim%}APQ Dimension Definition Source Measure%sDelimEleStart%LineCount');
	    bSuppressRule   = 0;
	    sProc           = '}bedrock.hier.sub.create';
	    ExecuteProcess( sProc, 'pLogOutput', nDebug,
	         'pDim', '}APQ Data Source Row', 'pHier', '', 'pSub', cSubSrc, 'pConsol', 'Total Rows', 'pAttr', '', 'pAttrValue', '',
	         'pLevelFrom', 0, 'pLevelTo', 0, 'pExclusions', '', 'pDelim', sDelimList, 'pAddToSubset', 0, 'pAlias', '', 
	         'pTemp', 1
	    );
	Else;
	    sFilter         = Expand('}APQ Dimension Hierarchies%sDelimEleStart%%sFinalDimension%%sDelimDim%}APQ Dimension Definition Source Measure%sDelimEleStart%vElement');
	    bSuppressRule   = 1;
	EndIf;
	bSuppressNull       = 1;
	bSuppressC          = 0;
	sProc               = '}bedrock.cube.view.create';
    ExecuteProcess( sProc, 'pLogOutput', nDebug,
        'pCube', cCubSrc, 'pView', cViewSrc, 'pFilter', sFilter,
        'pSuppressZero', bSuppressNull, 'pSuppressConsol', bSuppressC, 'pSuppressRules', bSuppressRule,
        'pDimDelim', sDelimDim, 'pEleStartDelim', sDelimEleStart, 'pEleDelim', sDelimEle,
        'pTemp', 1
    );
    If( nNewTemplate    = 1 );
        ViewSubsetAssign( cCubSrc, cViewSrc, '}APQ Data Source Row', cSubSrc );
    EndIf;
	DataSourceType      = 'VIEW';
	DataSourceNameForServer = cCubSrc;
	DatasourceCubeView  = cViewSrc;
	sSourceSyst         = 'cube: ' | cCubSrc;

ELSEIF( sSourceType @= 'DIMENSION' );
	# Source definition for the as Null for the DIM, we will use Bedrock.Dim.Clone to load the dimension in the epilog
	DataSourceType	    = 'NULL';
	sSourceDim 	        = Trim( CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Source Dimension Name', 'String' ) );
	sSourceDim 	        = Lower( sSourceDim );
	sSourceSub 	        = Trim( CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Source Subset Name', 'String' ) );
	sSourceMDX 	        = Trim( CellGetS( sSysDimensionCube, pDimToBuild, pID, 'MDX Expression', 'String' ) );
	sSourceMDX 	        = Lower( sSourceMDX );
	sSourceMDX 	        = IF( Scan( Expand( '[%sSourceDim%]' ), sSourceMDX ) = 0, '', sSourceMDX );
	sTargetDim 	        = sMyDimension;
	nDimClone 	        = 1;
	sSourceSyst         = 'dim: ' | sSourceDim;

ELSEIF( sSourceType @= 'PROCESS' );
	# Source definition for the as Null for the PROCESS, We will triger the TI from the epilog
	DataSourceType	    = 'NULL';
	nSourceIsProc 	    = 1;

ELSEIF( sSourceType @= 'ATTRIBUTE' );
	# Source definition is Null for the ATTRIBUTE, We will triger the bedrock TI from the epilog
	DataSourceType	    = 'NULL';
	nSourceIsProc 	    = 1;

ELSE;
	  IF( pDebug @>= '1' );
	  	sErr = 'Source not defined in the cube for the dimension: ' | pDimToBuild |' and step ' | pID;
	  	AsciiOutput( sDebugFile, sErr );
	  EndIF;
	  DataSourceType    = 'NULL';
	  ItemReject( sErr );
ENDIF;
#EndRegion - Define the DataSource (Type, Source Name and Query)
##############################################################################################################

##############################################################################################################
#Region - Check & clean target dimension (hierarchy)
# 	Check if exists
If( Scan( ':', sMyDimension ) = 0 );
	sMyAttrDimension    = sMyDimension;
	sDim                = sMyDimension;
	sHier               = sMyDimension;
Else;
    sMyAttrDimension    = SubSt( sMyDimension, 1, Scan( ':', sMyDimension ) - 1 );
    sDim                = SubSt( sMyDimension, 1, Scan( ':', sMyDimension ) - 1 );
    sHier               = SubSt( sMyDimension, Scan( ':', sMyDimension ) + 1, Scan( ':', sMyDimension ) - 1 );
EndIf;

# 	Clean the dimension hierarchy (only activated in step 1!)
IF( StringToNumber( pID ) = 1 % ( StringToNumber( pID ) > 1 & DimensionExists( sMyDimension ) = 0 ) );
    # Check the step (this code should only ever be executed on step 1)
    If( StringToNumber( pID ) > 1 );
        sMsg = Expand('%sThisProcName%: Step 1 is disabled. Creating temp dimension %sMyDimension% for loading %sFinalDimension% from step %pID%.');
        LogOutput( 'WARN', sMsg );
    EndIf;
    # Initialize temp clone dimension
    If( DimensionExists( sMyDimension ) = 0 );
        If( Scan( ':', sMyDimension ) = 0 );
        	DimensionCreate( sMyDimension );
        Else;
            HierarchyCreate( sDim, sHier );
        EndIf;
    EndIf;
	# Check if Rebuild Mode is activated
	# Element to delete if we are rebuilding except for the clone dimension (managed internally)
	IF( nRebuidMode = 1 & nDimClone = 0 & nSourceIsProc = 0 );
		DimensionDeleteAllElements( sMyDimension );
	ENDIF;
		
	# Attributes to delete if we are rebuilding
	# Loop through the attributes of the dimension
	If( nAttrRefreshMode = 1 );
	    If( DimensionExists( '}ElementAttributes_' | sMyAttrDimension ) = 1 & CubeExists( '}ElementAttributes_' | sMyAttrDimension ) = 1 );
	        CubeClearData( '}ElementAttributes_' | sMyAttrDimension );
    		i = 1;
    		While( DIMNM( '}ElementAttributes_' | sMyAttrDimension, i ) @<>'' );
    			AttrDelete( sMyAttrDimension, DIMNM( '}ElementAttributes_' | sMyAttrDimension, i ) );
    		End;
    	EndIf;
	EndIf;

	# Check if Unwind Mode is activated
	IF( nUnwindMode = 1 & nDimClone = 0 );

		# Prepare the Temp dimension with a copy from the original dimension
		IF(  sFinalDimension @<> sMyDimension);

			DimensionDeleteAllElements( sMyDimension );
    	    ExecuteProcess( '}bedrock.hier.clone', 'pLogOutput', nDebug,
    	        'pSrcDim', sFinalDimension, 'pSrcHier', '',
    	        'pTgtDim', sMyDimension, 'pTgtHier', '',
    	        'pAttr', 1, 'pUnwind', 2
    	    );
		ENDIF;

		# Check if there is specific consolidation to unwind
		IF( sUnwindConso @<> '' );

			# Create a temp list for the consolidation elements
			sTmpUnwindConso = sUnwindConso;

			#Loop through the elements of list
			WHILE( sTmpUnwindConso @<> '' );
				# Define the current consolidation to unwind
				IF( SCAN( sUnwindConsoSep, sTmpUnwindConso ) > 0 );
					sCurConso = SUBST( sTmpUnwindConso, 1, SCAN( sUnwindConsoSep, sTmpUnwindConso ) - 1 );
				ELSE;
					sCurConso = SUBST( sTmpUnwindConso, 1, LONG( sTmpUnwindConso ) );
				ENDIF;
				# Check if the current Consolidation exists in the dimension
				IF( DIMIX( sMyDimension, sCurConso ) = 0 );
					nErr = nErr + 1;
					sErr = sErr | IF( sErr @<> '', ' & ', '' ) | 'Invalid consolidation to unwind in ' | sMyDimension | ':' | sCurConso;
					IF( nDebug >= 1 );
						ASCIIOutput( sDebugFile, sErr );
					EndIF;
					LogOutput( 'INFO', sThisProcName | ' - ' | sErr );

				ELSE;

					# Unwind the current consolidation
					IF( DTYPE( sMyDimension, sCurConso ) @= 'C' & ELCOMPN( sMyDimension, sCurConso ) >= 1 );
					    ExecuteProcess( '}bedrock.hier.unwind',
					        'pLogOutput', nDebug, 'pStrictErrorHandling', 1,
					        'pDim', sMyDimension, 'pHier', '',
					        'pConsol', sCurConso,
					        'pRecursive', nUnwindRecursive, 'pDelim', sUnwindConsoSep 
					    );
					ENDIF;

				ENDIF;

				# Update the list of consolidation
				IF( SCAN( sUnwindConsoSep, sTmpUnwindConso ) > 0 );
					sTmpUnwindConso = SUBST( sTmpUnwindConso, LONG( sCurConso ) + LONG( sUnwindConsoSep ) + 1, LONG( sTmpUnwindConso ) );
				ELSE;
					sTmpUnwindConso = '';
				ENDIF;
			END;

		# If no specific consolidation is mentioned then we Unwind All
		ELSEIF( DNLEV( sMyDimension ) >= 2 );
		    ExecuteProcess( '}bedrock.hier.unwind',
		        'pLogOutput', nDebug, 'pStrictErrorHandling', 1,
		        'pDim', sMyDimension, 'pHier', '',
		        'pConsol', '*',
		        'pRecursive', 1, 'pDelim', sUnwindConsoSep
		    );
		ENDIF;
	ENDIF;
ENDIF;
#EndRegion - Check & clean target dimension (hierarchy)
##############################################################################################################

##############################################################################################################
#Region - Attribute Management
#Technical Attribute
IF( sSourceType @= 'ODBC' % sSourceType @= 'CSV' );
	sSourceTypeAttr = sSourceType | ' Source';
	AttrInsert( sMyAttrDimension, '',  sSourceTypeAttr, 'S' );
ENDIF;

# Insert attributes (aliases, Text, Num) only if the source is not ATTRIBUTE
IF( sSourceType @<> 'ATTRIBUTE');
  i = 1;
  WHILE( i <= iMaxAttributes );
  	IF( CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Attribute ' | NumberToString( i ) | ' Name', 'String' ) @<> '' );
  		sCurAttrName = CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Attribute ' | NumberToString( i ) | ' Name', 'String' );
  		sCurAttrType = CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Attribute ' | NumberToString( i ) | ' Type', 'String' );
  		IF( sCurAttrType @= '' );
  			sCurAttrType = 'S';
  		ENDIF;
  
  		AttrInsert( sMyAttrDimension, '', sCurAttrName, sCurAttrType );
  	ENDIF;
  	i = i + 1;
  END;
ENDIF;
#EndRegion - Attribute Management
##############################################################################################################

##############################################################################################################
#Region - Manage Dimension sorting on the first element. (only activated in step 1!)
IF( StringToNumber( pID ) = 1 );
	sSortFlag = CellGetS( sSysDimensionCube, pDimToBuild, 'Total Items', 'Dimension Sort Order', 'String' );

	IF( sSortFlag @= 'Y' );
		sCompSortType = CellGetS( sSysDimensionCube, pDimToBuild, 'Total Items', 'Component Sort Type', 'String' );
		sCompSortSense = CellGetS( sSysDimensionCube, pDimToBuild, 'Total Items', 'Component Sort Sense', 'String' );
		sEltSortType = CellGetS( sSysDimensionCube, pDimToBuild, 'Total Items', 'Element Sort Type', 'String' );
		sEltSortSense = CellGetS( sSysDimensionCube, pDimToBuild, 'Total Items', 'Element Sort Sense', 'String' );

		CellPutS( sCompSortType, cDimPropertyCube, pDimToBuild, 'SORTCOMPONENTSTYPE' );
		CellPutS( sCompSortSense, cDimPropertyCube, pDimToBuild, 'SORTCOMPONENTSSENSE' );
		CellPutS( sEltSortType, cDimPropertyCube, pDimToBuild, 'SORTELEMENTSTYPE' );
		CellPutS( sEltSortSense, cDimPropertyCube, pDimToBuild, 'SORTELEMENTSSENSE' );
	
		DimensionSortOrder( sMyDimension , sCompSortType , sCompSortSense, sEltSortType, sEltSortSense );
	ENDIF;
ENDIF;
#EndRegion - Manage Dimension sorting on the first element. (only activated in step 1!)
##############################################################################################################

##############################################################################################################
### END Prolog
573,553
##############################################################################################################
#Region - Header
# CUBEWISE APLIQODE FRAMEWORK VERSION 3.05
# Copyright Apliqo AG, a Cubewise Company. All rights reserved.
# This software and related documentation are provided under a license agreement containing restrictions on use and disclosure 
# and are protected by intellectual property laws. Except as expressly permitted in your license agreement or allowed by law, 
# you may not use, copy, reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish, 
# or display any part, in any form, or by any means.
##############################################################################################################

#****Begin: Generated Statements***
#****End: Generated Statements****

######################
### Logging - common script

IF( pDoProcessLogging @= '1' );
  nMetaDataRecordCount = nMetaDataRecordCount + 1;
EndIF;

######################
### Metadata script

### Count the records in source
nRecordCount = nRecordCount + 1;
#EndRegion - Header
##############################################################################################################
#Region - Original source template (ByParentChild)
IF( nNewTemplate < 1 );
    
    ### Skip Element empty
    IF( sSourceType @= 'CUBE' );
    	vElement = sValue;
    	vDimName = v1;
    	vRowID   = v2;
    ELSE;
        vElement = v1;
    ENDIF;
    IF( Trim( vElement ) @= '' );
    	ItemSkip;
    ENDIF;
    
    ##############################################################################################################
    #Region - Set variables
    ### Special case cube view data source need to read in variables
    IF( sSourceType @= 'CUBE' );
    	vParent1 = CellGetS( cCubSrc, vDimName, vRowID, 'vParent1' );
    	vParent2 = CellGetS( cCubSrc, vDimName, vRowID, 'vParent2' );
    	vParent3 = CellGetS( cCubSrc, vDimName, vRowID, 'vParent3' );
    	vParent4 = CellGetS( cCubSrc, vDimName, vRowID, 'vParent4' );
    	vParent5 = CellGetS( cCubSrc, vDimName, vRowID, 'vParent5' );
    	vParent6 = CellGetS( cCubSrc, vDimName, vRowID, 'vParent6' );
    	vParent7 = CellGetS( cCubSrc, vDimName, vRowID, 'vParent7' );
    	vParent8 = CellGetS( cCubSrc, vDimName, vRowID, 'vParent8' );
    	vWeight  = CellGetS( cCubSrc, vDimName, vRowID, 'vWeight' );
    	vType    = CellGetS( cCubSrc, vDimName, vRowID, 'vType' );
    ENDIF;
    
    ### If ODBC then treat the string "NULL" the same as blank
    IF( sSourceType @= 'ODBC' );
    	vParent1 = If( v2  @= 'NULL', '',  v2 );
    	vParent2 = If( v3  @= 'NULL', '',  v3 );
    	vParent3 = If( v4  @= 'NULL', '',  v4 );
    	vParent4 = If( v5  @= 'NULL', '',  v5 );
    	vParent5 = If( v6  @= 'NULL', '',  v6 );
    	vParent6 = If( v7  @= 'NULL', '',  v7 );
    	vParent7 = If( v8  @= 'NULL', '',  v8 );
    	vParent8 = If( v9  @= 'NULL', '',  v9 );
    	vComment = If( v10 @= 'NULL', '',  v10 );
    	vWeight  = If( v11 @= 'NULL', '1', v11 );
    	vType    = If( v12 @= 'NULL', 'N', v12 );
    ENDIF;
    
    ### TEXT
    IF( sSourceType @= 'CSV' );
    	vParent1 = Trim( v2 );
    	vParent2 = Trim( v3 );
    	vParent3 = Trim( v4 );
    	vParent4 = Trim( v5 );
    	vParent5 = Trim( v6 );
    	vParent6 = Trim( v7 );
    	vParent7 = Trim( v8 );
    	vParent8 = Trim( v9 );
    	vComment = Trim( v10 );
    	vWeight  = Trim( v11 );
    	vType    = Trim( v12 );
    ENDIF;
    #EndRegion - Set variables
    ##############################################################################################################

    ### Allow mapping input to contain alias names rather than principal names
    ### (must check on sFinalDimension not sMyDimension in case of multi-step load with }Temp dimension)
    If( nAliasAsElement = 1 );
        If( DimIx( sFinalDimension, vElement ) > 0 );
            vElement = DimensionElementPrincipalName( sFinalDimension, vElement );
        EndIf;
        If( DimIx( sFinalDimension, vParent1 ) > 0 );
            vParent1 = DimensionElementPrincipalName( sFinalDimension, vParent1 );
            If( DimIx( sFinalDimension, vParent2 ) > 0 );
                vParent2 = DimensionElementPrincipalName( sFinalDimension, vParent2 );
                If( DimIx( sFinalDimension, vParent3 ) > 0 );
                    vParent3 = DimensionElementPrincipalName( sFinalDimension, vParent3 );
                    If( DimIx( sFinalDimension, vParent4 ) > 0 );
                        vParent4 = DimensionElementPrincipalName( sFinalDimension, vParent4 );
                        If( DimIx( sFinalDimension, vParent5 ) > 0 );
                            vParent5 = DimensionElementPrincipalName( sFinalDimension, vParent5 );
                            If( DimIx( sFinalDimension, vParent6 ) > 0 );
                                vParent6 = DimensionElementPrincipalName( sFinalDimension, vParent6 );
                                If( DimIx( sFinalDimension, vParent7 ) > 0 );
                                    vParent7 = DimensionElementPrincipalName( sFinalDimension, vParent7 );
                                    If( DimIx( sFinalDimension, vParent8 ) > 0 );
                                        vParent8 = DimensionElementPrincipalName( sFinalDimension, vParent8 );
                                    EndIf;
                                EndIf;
                            EndIf;
                        EndIf;
                    EndIf;
                EndIf;
            EndIf;
        EndIf;
    EndIf;
    
    ### Consolidation Management
    nConso = 0;
    If( vWeight @= '+' );
    	nConso = 1;
    ELSEIF( vWeight @= '-' );
    	nConso = -1;
    ELSEIF( vWeight @= '' );
    	nConso = 1;
    ELSEIF( vWeight @= '~' );
    	nConso = 1;
    ELSE;
     	nConso = StringToNumber( vWeight );
    ENDIF;
    
    ### Type management if the field is not filled
    IF( vType @= '' );
    	vType = 'N';
    ENDIF;
    
    ### Child Element Insertion
    IF( DIMIX( sMyDimension, vElement ) = 0 );
    	DimensionElementInsert( sMyDimension, '', vElement, vType );
    ENDIF;
    
    ### If update attr indirectly need to update element attribute framework
    IF( nLoadAttrIndirectly = 1 );
        IF( DIMIX( '}APQ Dimension Elements', vElement ) = 0 );
        	DimensionElementInsert( '}APQ Dimension Elements', '', vElement, 'N' );
        ENDIF;
    ENDIF;
    
    ### Attached parents links
    IF( vParent1 @<> '' );
        IF( DimIx( sFinalDimension, vParent1 ) > 0 );
            # If parent element already exists with type N and automatic conversion to C has not been explicitly allowed then error with message  
            IF( DType( sFinalDimension, vParent1 ) @= 'N' & nAllowNtoC <> 1 );
                sMsg = Expand('Element %vParent1% currently exists as a Leaf in %sFinalDimension% but has been mapped as a parent. Element type conversion is prohibited in the global settings for this dimension.');
                ItemReject( sMsg );
            ELSEIF( DType( sFinalDimension, vParent1 ) @= 'N' & nAllowNtoC = 1 & sHier @<> sDim );
                # N to C conversion has been allowed but the dimension contains hierarchies. Conversion will fail due to conflict with Leaves hierarchy. Element must first be manually deleted from Leaves
                sMsg = Expand('Element %vParent1% currently exists in LEAVES hierarchy which prohibits element type conversion. The element must be manually deleted from Leaves.');
                ItemReject( sMsg );
            ENDIF;
    	ELSEIF( DimIx( sMyDimension, vParent1 ) = 0 );
    		DimensionElementInsert( sMyDimension, '', vParent1, 'C' );
    	ENDIF;
    
    	IF( vElement @<> '' & vParent1 @<> 'C' );
    		DimensionElementInsert( sMyDimension, '', vParent1, 'C' );
    		DimensionElementComponentAdd( sMyDimension, vParent1, vElement, nConso );
    	ENDIF;
    ENDIF;
    
    
    ### Insert ParentHierarchy
    i = 2;
    WHILE( i < iMaxParent );
    
    	sMyUpParent = Expand( '%vParent' | NumberToString( i ) | '%' );
    	sMyDownParent = Expand( '%vParent' | NumberToString( i-1 ) | '%' );
    
        IF( DimIx( sFinalDimension, sMyUpParent ) > 0 );
            # If parent element already exists with type N and automatic conversion to C has not been explicitly allowed then error with message  
            IF( DType( sFinalDimension, sMyUpParent ) @= 'N' & nAllowNtoC <> 1 );
                sMsg = Expand('Element %sMyUpParent% currently exists as a Leaf in %sFinalDimension% but has been mapped as a parent. Element type conversion is prohibited in the global settings for this dimension.');
                ItemReject( sMsg );
            ELSEIF( DType( sFinalDimension, sMyUpParent ) @= 'N' & nAllowNtoC = 1 & sHier @<> sDim );
                # N to C conversion has been allowed but the dimension contains hierarchies. Conversion will fail due to conflict with Leaves hierarchy. Element must first be manually deleted from Leaves
                sMsg = Expand('Element %sMyUpParent% currently exists in LEAVES hierarchy which prohibits element type conversion. The element must be manually deleted from Leaves.');
                ItemReject( sMsg );
            ENDIF;
        ENDIF;
    
        IF( DimIx( sFinalDimension, sMyDownParent ) > 0 );
            # If parent element already exists with type N and automatic conversion to C has not been explicitly allowed then error with message  
            IF( DType( sFinalDimension, sMyDownParent ) @= 'N' & nAllowNtoC <> 1 );
                sMsg = Expand('Element %sMyDownParent% currently exists as a Leaf in %sFinalDimension% but has been mapped as a parent. Element type conversion is prohibited in the global settings for this dimension.');
                ItemReject( sMsg );
            ELSEIF( DType( sFinalDimension, sMyDownParent ) @= 'N' & nAllowNtoC = 1 & sHier @<> sDim );
                # N to C conversion has been allowed but the dimension contains hierarchies. Conversion will fail due to conflict with Leaves hierarchy. Element must first be manually deleted from Leaves
                sMsg = Expand('Element %sMyDownParent% currently exists in LEAVES hierarchy which prohibits element type conversion. The element must be manually deleted from Leaves.');
                ItemReject( sMsg );
            ENDIF;
        ENDIF;
        
    	IF( DIMIX( sMyDimension, sMyUpParent ) = 0 );
    		DimensionElementInsert( sMyDimension, '', sMyUpParent, 'C' );
    	ENDIF;
    
    	IF( DIMIX( sMyDimension, sMyDownParent ) = 0 );
    		DimensionElementInsert( sMyDimension, '', sMyDownParent, 'C' );
    	ENDIF;
    
    	IF( sMyDownParent @<> '' & sMyUpParent @<> '' );
    		DimensionElementComponentAdd( sMyDimension, sMyUpParent, sMyDownParent, 1 );
    	ENDIF;
    	i = i + 1;
    END;
#EndRegion - Original source template (ByParentChild)
##############################################################################################################
ELSEIF( nNewTemplate = 1 );
##############################################################################################################
#Region - New source template (ByRollup)
    
    ### Skip Element empty
    IF( sSourceType @= 'CUBE' );
        IF( nValue = 0 );
        	ItemSkip;
        ELSE;
        	vDimName = v1;
        	vRowID   = v2;
        ENDIF;
    ELSEIF( nMetaDataRecordCount = 1 );
        # Header record, only relevant for attributes not metadata
        ItemSkip;
    ENDIF;

    ##############################################################################################################
    #Region - Set variables
    ### Special case cube view data source need to read in variables
    IF( sSourceType @= 'CUBE' );
        vType   = CellGetS( cCubSrc, vDimName, vRowID, 'vType' );
        vWeight = CellGetS( cCubSrc, vDimName, vRowID, 'vWeight' );
        vL1     = CellGetS( cCubSrc, vDimName, vRowID, 'vParent1' );
        vL2     = CellGetS( cCubSrc, vDimName, vRowID, 'vParent2' );
        vL3     = CellGetS( cCubSrc, vDimName, vRowID, 'vParent3' );
        vL4     = CellGetS( cCubSrc, vDimName, vRowID, 'vParent4' );
        vL5     = CellGetS( cCubSrc, vDimName, vRowID, 'vParent5' );
        vL6     = CellGetS( cCubSrc, vDimName, vRowID, 'vParent6' );
        vL7     = CellGetS( cCubSrc, vDimName, vRowID, 'vParent7' );
        vL8     = CellGetS( cCubSrc, vDimName, vRowID, 'vParent8' );
        vL9     = CellGetS( cCubSrc, vDimName, vRowID, 'vParent9' );
        vL10    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent10' );
        vL11    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent11' );
        vL12    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent12' );
        vL13    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent13' );
        vL14    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent14' );
        vL15    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent15' );
        vL16    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent16' );
        vL17    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent17' );
        vL18    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent18' );
        vL19    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent19' );
        vL20    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent20' );
        vL21    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent21' );
        vL22    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent22' );
        vL23    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent23' );
        vL24    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent24' );
        vL25    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent25' );
        vL26    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent26' );
        vL27    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent27' );
        vL28    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent28' );
        vL29    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent29' );
        vL30    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent30' );
    ENDIF;

    ### If ODBC then treat the string "NULL" the same as blank
    IF( sSourceType @= 'ODBC' );
    	vL1     = If( v1  @= 'NULL', '',  v1 );
    	vL2     = If( v2  @= 'NULL', '',  v2 );
    	vL3     = If( v3  @= 'NULL', '',  v3 );
    	vL4     = If( v4  @= 'NULL', '',  v4 );
    	vL5     = If( v5  @= 'NULL', '',  v5 );
    	vL6     = If( v6  @= 'NULL', '',  v6 );
    	vL7     = If( v7  @= 'NULL', '',  v7 );
    	vL8     = If( v8  @= 'NULL', '',  v8 );
    	vL9     = If( v9  @= 'NULL', '',  v9 );
    	vL10    = If( v10 @= 'NULL', '',  v10 );
    	vL11    = If( v11 @= 'NULL', '',  v11 );
    	vL12    = If( v12 @= 'NULL', '',  v12 );
    	vL13    = If( v13 @= 'NULL', '',  v13 );
    	vL14    = If( v14 @= 'NULL', '',  v14 );
    	vL15    = If( v15 @= 'NULL', '',  v15 );
    	vL16    = If( v16 @= 'NULL', '',  v16 );
    	vL17    = If( v17 @= 'NULL', '',  v17 );
    	vL18    = If( v18 @= 'NULL', '',  v18 );
    	vL19    = If( v19 @= 'NULL', '',  v19 );
    	vL20    = If( v20 @= 'NULL', '',  v20 );
    	vL21    = If( v21 @= 'NULL', '',  v21 );
    	vL22    = If( v22 @= 'NULL', '',  v22 );
    	vL23    = If( v23 @= 'NULL', '',  v23 );
    	vL24    = If( v24 @= 'NULL', '',  v24 );
    	vL25    = If( v25 @= 'NULL', '',  v25 );
    	vL26    = If( v26 @= 'NULL', '',  v26 );
    	vL27    = If( v27 @= 'NULL', '',  v27 );
    	vL28    = If( v28 @= 'NULL', '',  v28 );
    	vL29    = If( v29 @= 'NULL', '',  v29 );
    	vL30    = If( v30 @= 'NULL', '',  v30 );
    	vType   = If( v32 @= 'NULL', 'N', v31 );
    	vWeight = If( v31 @= 'NULL', '1', v32 );
    ENDIF;
    
    ### If text then trim
    IF( sSourceType @= 'CSV' );
    	vL1     = Trim( v2 );
    	vL2     = Trim( v3 );
    	vL3     = Trim( v4 );
    	vL4     = Trim( v5 );
    	vL5     = Trim( v6 );
    	vL6     = Trim( v7 );
    	vL7     = Trim( v8 );
    	vL8     = Trim( v9 );
    	vL9     = Trim( v10 );
    	vL10    = Trim( v11 );
    	vL11    = Trim( v12 );
    	vL12    = Trim( v13 );
    	vL13    = Trim( v14 );
    	vL14    = Trim( v15 );
    	vL15    = Trim( v16 );
    	vL16    = Trim( v17 );
    	vL17    = Trim( v18 );
    	vL18    = Trim( v19 );
    	vL19    = Trim( v20 );
    	vL20    = Trim( v21 );
    	vL21    = Trim( v22 );
    	vL22    = Trim( v23 );
    	vL23    = Trim( v24 );
    	vL24    = Trim( v25 );
    	vL25    = Trim( v26 );
    	vL26    = Trim( v27 );
    	vL27    = Trim( v28 );
    	vL28    = Trim( v29 );
    	vL29    = Trim( v30 );
    	vL30    = Trim( v31 );
    	vType   = Trim( v32 );
    	vWeight = Trim( v33 );
    ENDIF;
    #EndRegion - Set variables
    ##############################################################################################################
    
    ### Consolidation Management
    nConso = 0;
    If( vWeight @= '+' );
    	nConso = 1;
    ELSEIF( vWeight @= '-' );
    	nConso = -1;
    ELSEIF( vWeight @= '' );
    	nConso = 1;
    ELSEIF( vWeight @= '~' );
    	nConso = 1;
    ELSE;
     	nConso = StringToNumber( vWeight );
    ENDIF;
    
    ### Type management if the field is not filled
    IF( vType @= '' );
    	vType = 'N';
    ENDIF;

    ##############################################################################################################
    #Region - For each record determine which level holds element value and which level is parent
    If( vL1 @<> '' );
        sL1     = vL1;
        sEle    = sL1;
        sPar    = '';
    ElseIf( vL2 @<> '' );
        sL2     = vL2;
        sEle    = sL2;
        sPar    = sL1;
    ElseIf( vL3 @<> '' );
        sL3     = vL3;
        sEle    = sL3;
        sPar    = sL2;
    ElseIf( vL4 @<> '' );
        sL4     = vL4;
        sEle    = sL4;
        sPar    = sL3;
    ElseIf( vL5 @<> '' );
        sL5     = vL5;
        sEle    = sL5;
        sPar    = sL4;
    ElseIf( vL6 @<> '' );
        sL6     = vL6;
        sEle    = sL6;
        sPar    = sL5;
    ElseIf( vL7 @<> '' );
        sL7     = vL7;
        sEle    = sL7;
        sPar    = sL6;
    ElseIf( vL8 @<> '' );
        sL8     = vL8;
        sEle    = sL8;
        sPar    = sL7;
    ElseIf( vL9 @<> '' );
        sL9     = vL9;
        sEle    = sL9;
        sPar    = sL8;
    ElseIf( vL10 @<> '' );
        sL10    = vL10;
        sEle    = sL10;
        sPar    = sL9;
    ElseIf( vL11 @<> '' );
        sL11    = vL11;
        sEle    = sL11;
        sPar    = sL10;
    ElseIf( vL12 @<> '' );
        sL12    = vL12;
        sEle    = sL12;
        sPar    = sL11;
    ElseIf( vL13 @<> '' );
        sL13    = vL13;
        sEle    = sL13;
        sPar    = sL12;
    ElseIf( vL14 @<> '' );
        sL14    = vL14;
        sEle    = sL14;
        sPar    = sL13;
    ElseIf( vL15 @<> '' );
        sL15    = vL15;
        sEle    = sL15;
        sPar    = sL14;
    ElseIf( vL16 @<> '' );
        sL16    = vL16;
        sEle    = sL16;
        sPar    = sL15;
    ElseIf( vL17 @<> '' );
        sL17    = vL17;
        sEle    = sL17;
        sPar    = sL16;
    ElseIf( vL18 @<> '' );
        sL18    = vL18;
        sEle    = sL18;
        sPar    = sL17;
    ElseIf( vL19 @<> '' );
        sL19    = vL19;
        sEle    = sL19;
        sPar    = sL18;
    ElseIf( vL20 @<> '' );
        sL20    = vL20;
        sEle    = sL20;
        sPar    = sL19;
    ElseIf( vL21 @<> '' );
        sL21    = vL21;
        sEle    = sL21;
        sPar    = sL20;
    ElseIf( vL22 @<> '' );
        sL22    = vL22;
        sEle    = sL22;
        sPar    = sL21;
    ElseIf( vL23 @<> '' );
        sL23    = vL23;
        sEle    = sL23;
        sPar    = sL22;
    ElseIf( vL24 @<> '' );
        sL24    = vL24;
        sEle    = sL24;
        sPar    = sL23;
    ElseIf( vL25 @<> '' );
        sL25    = vL25;
        sEle    = sL25;
        sPar    = sL24;
    ElseIf( vL26 @<> '' );
        sL26    = vL26;
        sEle    = sL26;
        sPar    = sL25;
    ElseIf( vL27 @<> '' );
        sL27    = vL27;
        sEle    = sL27;
        sPar    = sL26;
    ElseIf( vL28 @<> '' );
        sL28    = vL28;
        sEle    = sL28;
        sPar    = sL27;
    ElseIf( vL29 @<> '' );
        sL29    = vL29;
        sEle    = sL29;
        sPar    = sL28;
    ElseIf( vL30 @<> '' );
        sL30    = vL30;
        sEle    = sL30;
        sPar    = sL29;
    EndIf;
    #EndRegion - For each record determine which level holds element value and which level is parent
    ##############################################################################################################

    ### Allow mapping input to contain alias names rather than principal names
    ### (must check on sFinalDimension not sMyDimension in case of multi-step load with }Temp dimension)
    If( nAliasAsElement = 1 );
        If( DimIx( sFinalDimension, sEle ) > 0 );
            sEle = DimensionElementPrincipalName( sFinalDimension, sEle );
        EndIf;
        If( DimIx( sFinalDimension, sPar ) > 0 );
            sPar = DimensionElementPrincipalName( sFinalDimension, sPar );
        EndIf;
    EndIf;

    ### Insert element and add to parent
    If( DimIx( sMyDimension, sEle ) = 0 );
        DimensionElementInsert( sMyDimension, '', sEle, vType );
    EndIf;

    ### If update attr indirectly need to update element attribute framework
    If( nLoadAttrIndirectly = 1 );
        If( DimIx( '}APQ Dimension Elements', sEle ) = 0 );
        	DimensionElementInsert( '}APQ Dimension Elements', '', sEle, 'N' );
        EndIf;
    EndIf;

    ### Checks for validity of Parent-Child relationship
    If( DimIx( sFinalDimension, sPar ) > 0 );
        sMsg = '';
        # If parent element already exists with type N and automatic conversion to C has not been explicitly allowed then error with message  
        If( DType( sFinalDimension, sPar ) @= 'N' & nAllowNtoC <> 1 );
            sMsg = Expand('Element %sPar% currently exists as a Leaf in %sFinalDimension% but has been mapped as a parent. Element type conversion is prohibited in the global settings for this dimension.');
        ElseIf( DType( sFinalDimension, sPar ) @= 'N' & nAllowNtoC = 1 & sHier @<> sDim );
            # N to C conversion has been allowed but the dimension contains hierarchies. Conversion will fail due to conflict with Leaves hierarchy. Element must first be manually deleted from Leaves
            sMsg = Expand('Element %sPar% currently exists in LEAVES hierarchy which prohibits element type conversion. The element must be manually deleted from Leaves.');
        ElseIf( DType( sFinalDimension, sPar ) @= 'S' % vType @= 'S' );
            # String elements can't be parents or children
            sMsg = Expand('Cannot add %sEle% to %sPar%. Element type of parent or child is String.');
        ElseIf( sEle @= sPar );
            sMsg = Expand('Circular reference detected! Cannot add %sEle% as child of %sPar%.');
        ElseIf( DimIx( sFinalDimension, sEle ) > 0 );
            If( ElIsAnc( sFinalDimension, sEle, sPar ) = 1 );
                sMsg = Expand('Circular reference detected! Cannot add %sEle% as child of %sPar%.');
            EndIf;
        EndIf;
        If( sMsg @<> '' );
            ItemReject( sMsg );
        EndIf;
    EndIf;

    ### Checks passed. Add to parent.
    If( sPar @<> '' );
        DimensionElementComponentAdd( sMyDimension, sPar, sEle, nConso );
    EndIf;
ENDIF;
#EndRegion - New source template (ByRollup)
##############################################################################################################

##############################################################################################################
### END Metadata
574,1029
##############################################################################################################
#Region - Header
# CUBEWISE APLIQODE FRAMEWORK VERSION 3.05
# Copyright Apliqo AG, a Cubewise Company. All rights reserved.
# This software and related documentation are provided under a license agreement containing restrictions on use and disclosure 
# and are protected by intellectual property laws. Except as expressly permitted in your license agreement or allowed by law, 
# you may not use, copy, reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish, 
# or display any part, in any form, or by any means.
##############################################################################################################

#****Begin: Generated Statements***
#****End: Generated Statements****

######################
### Logging - common script

nDataRecordCount = nDataRecordCount + 1;

sDebugFile = cDebugFile | '_Data.log';
#EndRegion - Header
##############################################################################################################
#Region - Original source template (ByParentChild)
IF( nNewTemplate < 1 );
    
    ### Skip Element empty
    IF( sSourceType @= 'CUBE' );
    	vElement = sValue;
    	vDimName = v1;
    	vRowID   = v2;
    ELSE;
        vElement = v1;
    ENDIF;
    IF( Trim( vElement ) @= '' );
    	ItemSkip;
    ENDIF;
    
    ### Allow mapping input to contain alias names rather than principal names
    ### (must check on sFinalDimension not sMyDimension in case of multi-step load with }Temp dimension)
    If( nAliasAsElement = 1 );
        If( DimIx( sFinalDimension, vElement ) > 0 );
            vElement = DimensionElementPrincipalName( sFinalDimension, vElement );
        EndIf;
    EndIf;
    
    ##############################################################################################################
    #Region - Set variables
    ### Special case cube view data source need to read in variables
    IF( sSourceType @= 'CUBE' );
    	vAttribute1  = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute1' );
    	vAttribute2  = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute2' );
    	vAttribute3  = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute3' );
    	vAttribute4  = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute4' );
    	vAttribute5  = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute5' );
    	vAttribute6  = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute6' );
    	vAttribute7  = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute7' );
    	vAttribute8  = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute8' );
    	vAttribute9  = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute9' );
    	vAttribute10 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute10' );
    	vAttribute11 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute11' );
    	vAttribute12 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute12' );
    	vAttribute13 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute13' );
    	vAttribute14 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute14' );
    	vAttribute15 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute15' );
    	vAttribute16 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute16' );
    	vAttribute17 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute17' );
    	vAttribute18 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute18' );
    	vAttribute19 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute19' );
    	vAttribute20 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute20' );
    	vAttribute21 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute21' );
    	vAttribute22 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute22' );
    	vAttribute23 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute23' );
    	vAttribute24 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute24' );
    	vAttribute25 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute25' );
    	vAttribute26 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute26' );
    	vAttribute27 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute27' );
    	vAttribute28 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute28' );
    	vAttribute29 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute29' );
    	vAttribute30 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute30' );
    	vAttribute31 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute31' );
    	vAttribute32 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute32' );
    	vAttribute33 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute33' );
    	vAttribute34 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute34' );
    	vAttribute35 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute35' );
    	vAttribute36 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute36' );
    	vAttribute37 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute37' );
    	vAttribute38 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute38' );
    	vAttribute39 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute39' );
    	vAttribute40 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute40' );
    	vAttribute41 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute41' );
    	vAttribute42 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute42' );
    	vAttribute43 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute43' );
    	vAttribute44 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute44' );
    	vAttribute45 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute45' );
    	vAttribute46 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute46' );
    	vAttribute47 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute47' );
    	vAttribute48 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute48' );
    	vAttribute49 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute49' );
    	vAttribute50 = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute50' );
    ENDIF;
    
    ### If ODBC then treat the string "NULL" the same as blank
    IF( sSourceType @= 'ODBC' );
    	vAttribute1  = If( v13 @= 'NULL', '', v13 );
        vAttribute2  = If( v14 @= 'NULL', '', v14 );
        vAttribute3  = If( v15 @= 'NULL', '', v15 );
        vAttribute4  = If( v16 @= 'NULL', '', v16 );
        vAttribute5  = If( v17 @= 'NULL', '', v17 );
        vAttribute6  = If( v18 @= 'NULL', '', v18 );
        vAttribute7  = If( v19 @= 'NULL', '', v19 );
        vAttribute8  = If( v20 @= 'NULL', '', v20 );
        vAttribute9  = If( v21 @= 'NULL', '', v21 );
        vAttribute10 = If( v22 @= 'NULL', '', v22 );
        vAttribute11 = If( v23 @= 'NULL', '', v23 );
        vAttribute12 = If( v24 @= 'NULL', '', v24 );
        vAttribute13 = If( v25 @= 'NULL', '', v25 );
        vAttribute14 = If( v26 @= 'NULL', '', v26 );
        vAttribute15 = If( v27 @= 'NULL', '', v27 );
        vAttribute16 = If( v28 @= 'NULL', '', v28 );
        vAttribute17 = If( v29 @= 'NULL', '', v29 );
        vAttribute18 = If( v30 @= 'NULL', '', v30 );
        vAttribute19 = If( v31 @= 'NULL', '', v31 );
        vAttribute20 = If( v32 @= 'NULL', '', v32 );
        vAttribute21 = If( v33 @= 'NULL', '', v33 );
        vAttribute22 = If( v34 @= 'NULL', '', v34 );
        vAttribute23 = If( v35 @= 'NULL', '', v35 );
        vAttribute24 = If( v36 @= 'NULL', '', v36 );
        vAttribute25 = If( v37 @= 'NULL', '', v37 );
        vAttribute26 = If( v38 @= 'NULL', '', v38 );
        vAttribute27 = If( v39 @= 'NULL', '', v39 );
        vAttribute28 = If( v40 @= 'NULL', '', v40 );
        vAttribute29 = If( v41 @= 'NULL', '', v41 );
        vAttribute30 = If( v42 @= 'NULL', '', v42 );
        vAttribute31 = If( v43 @= 'NULL', '', v43 );
        vAttribute32 = If( v44 @= 'NULL', '', v44 );
        vAttribute33 = If( v45 @= 'NULL', '', v45 );
        vAttribute34 = If( v46 @= 'NULL', '', v46 );
        vAttribute35 = If( v47 @= 'NULL', '', v47 );
        vAttribute36 = If( v48 @= 'NULL', '', v48 );
        vAttribute37 = If( v49 @= 'NULL', '', v49 );
        vAttribute38 = If( v50 @= 'NULL', '', v50 );
        vAttribute39 = If( v51 @= 'NULL', '', v51 );
        vAttribute40 = If( v52 @= 'NULL', '', v52 );
        vAttribute41 = If( v43 @= 'NULL', '', v53 );
        vAttribute42 = If( v44 @= 'NULL', '', v54 );
        vAttribute43 = If( v45 @= 'NULL', '', v55 );
        vAttribute44 = If( v46 @= 'NULL', '', v56 );
        vAttribute45 = If( v47 @= 'NULL', '', v57 );
        vAttribute46 = If( v48 @= 'NULL', '', v58 );
        vAttribute47 = If( v49 @= 'NULL', '', v59 );
        vAttribute48 = If( v50 @= 'NULL', '', v60 );
        vAttribute49 = If( v51 @= 'NULL', '', v61 );
        vAttribute50 = If( v52 @= 'NULL', '', v62 );
    EndIF;
    
    ### If Text then trim
    IF( sSourceType @= 'CSV' );
    	vAttribute1  = Trim( v13 );
        vAttribute2  = Trim( v14 );
        vAttribute3  = Trim( v15 );
        vAttribute4  = Trim( v16 );
        vAttribute5  = Trim( v17 );
        vAttribute6  = Trim( v18 );
        vAttribute7  = Trim( v19 );
        vAttribute8  = Trim( v20 );
        vAttribute9  = Trim( v21 );
        vAttribute10 = Trim( v22 );
        vAttribute11 = Trim( v23 );
        vAttribute12 = Trim( v24 );
        vAttribute13 = Trim( v25 );
        vAttribute14 = Trim( v26 );
        vAttribute15 = Trim( v27 );
        vAttribute16 = Trim( v28 );
        vAttribute17 = Trim( v29 );
        vAttribute18 = Trim( v30 );
        vAttribute19 = Trim( v31 );
        vAttribute20 = Trim( v32 );
        vAttribute21 = Trim( v33 );
        vAttribute22 = Trim( v34 );
        vAttribute23 = Trim( v35 );
        vAttribute24 = Trim( v36 );
        vAttribute25 = Trim( v37 );
        vAttribute26 = Trim( v38 );
        vAttribute27 = Trim( v39 );
        vAttribute28 = Trim( v40 );
        vAttribute29 = Trim( v41 );
        vAttribute30 = Trim( v42 );
        vAttribute31 = Trim( v43 );
        vAttribute32 = Trim( v44 );
        vAttribute33 = Trim( v45 );
        vAttribute34 = Trim( v46 );
        vAttribute35 = Trim( v47 );
        vAttribute36 = Trim( v48 );
        vAttribute37 = Trim( v49 );
        vAttribute38 = Trim( v50 );
        vAttribute39 = Trim( v51 );
        vAttribute40 = Trim( v52 );
        vAttribute41 = Trim( v53 );
        vAttribute42 = Trim( v54 );
        vAttribute43 = Trim( v55 );
        vAttribute44 = Trim( v56 );
        vAttribute45 = Trim( v57 );
        vAttribute46 = Trim( v58 );
        vAttribute47 = Trim( v59 );
        vAttribute48 = Trim( v60 );
        vAttribute49 = Trim( v61 );
        vAttribute50 = Trim( v62 );
    EndIF;
    #EndRegion - Set variables
    ##############################################################################################################

    ##############################################################################################################
    #Region - Attribute Management
    IF( sSourceType @= 'ODBC' % sSourceType @= 'CSV' );
    	
    	sPrevSource = AttrS( sMyAttrDimension, vElement, sSourceTypeAttr );
    	IF( sPrevSource @= '' );
    		AttrPutS( sSourceSyst, sMyAttrDimension, vElement, sSourceTypeAttr );
    	ELSE;
    		IF( SCAN( sSourceSyst, sPrevSource ) = 0 );
    			AttrPutS( sPrevSource | ', ' | sSourceSyst, sMyAttrDimension, vElement, sSourceTypeAttr );
    		ENDIF;
    	ENDIF;
    ENDIF;
    
    i = 1;
    WHILE( i <= iMaxAttributes );
    	
    	sMyCurrentAttribute = CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Attribute ' | NumberToString(i) | ' Name', 'String' );
    	sMyAttributeValue = Expand( '%vAttribute' | NumberToString(i) | '%' );
    	
    	IF( sMyCurrentAttribute @<> '' & sMyAttributeValue @<> '' );
    	    
    	    If( sMyAttributeValue @= cBlankVal & nLoadAttrIndirectly = 0 ); 
    	        sMyAttributeValue = '';
    	    EndIf;
    		sMyCurrentAttributeType = CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Attribute ' | NumberToString(i) | ' Type', 'String' );
    		sMyCurrentAttributeLang = CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Attribute ' | NumberToString(i) | ' Locale', 'String' );
    
    		IF( sMyCurrentAttributeType @= 'N' & nLoadAttrIndirectly = 0 );			
    			nMyAttributeValue = StringToNumber( sMyAttributeValue );
    			# If alternate hier then we need to address the hier in the element of cellisupdateable and dim of attrputs!
    			IF( sMyDimension @= sMyAttrDimension );
        			IF( sMyCurrentAttributeLang @= '' & CellIsUpdateable( '}ElementAttributes_' | sMyAttrDimension, vElement, sMyCurrentAttribute ) = 1 );
        				AttrPutN( nMyAttributeValue, sMyDimension, vElement, sMyCurrentAttribute );
        			ELSEIF( DIMIX( '}Cultures', sMyCurrentAttributeLang ) > 0 );
        			    IF( CubeExists( '}LocalizedElementAttributes_' | sMyAttrDimension ) = 0 );
        			        AttrPutN( nMyAttributeValue, sMyDimension, vElement, sMyCurrentAttribute, sMyCurrentAttributeLang );
        			    ELSEIF( CellIsUpdateable( '}LocalizedElementAttributes_' | sMyAttrDimension, vElement, sMyCurrentAttributeLang, sMyCurrentAttribute ) = 1 );
        			        AttrPutN( nMyAttributeValue, sMyDimension, vElement, sMyCurrentAttribute, sMyCurrentAttributeLang );
        			    ENDIF;
        			ENDIF;
        		ELSE;
        			IF( sMyCurrentAttributeLang @= '' & CellIsUpdateable( '}ElementAttributes_' | sMyAttrDimension, sHier:vElement, sMyCurrentAttribute ) = 1 );
        				AttrPutN( nMyAttributeValue, sMyDimension, vElement, sMyCurrentAttribute );
        			ELSEIF( DIMIX( '}Cultures', sMyCurrentAttributeLang ) > 0 );
        			    IF( CubeExists( '}LocalizedElementAttributes_' | sMyAttrDimension ) = 0 );
        			        AttrPutN( nMyAttributeValue, sMyDimension, vElement, sMyCurrentAttribute, sMyCurrentAttributeLang );
        			    ELSEIF( CellIsUpdateable( '}LocalizedElementAttributes_' | sMyAttrDimension, sHier:vElement, sMyCurrentAttributeLang, sMyCurrentAttribute ) = 1 );
        			        AttrPutN( nMyAttributeValue, sMyDimension, vElement, sMyCurrentAttribute, sMyCurrentAttributeLang );
        			    ENDIF;
        			ENDIF;
        		ENDIF;
    		ELSE;		
    			# Get the concatenation type. Type 1 = "Code - Attribute". Type 2 = "Attribute (Code)"
    			sAttributeConcatType = CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Attribute ' | NumberToString(i) | ' Code Concatenation', 'String' );
    
    			IF( sMyAttributeValue @<> '' & sMyAttributeValue @<> cBlankVal );
    			    IF( SUBST( sAttributeConcatType,1,6 ) @= 'Type 1' );
        				sMyAttributeValue = vElement |' - '| sMyAttributeValue;
        			ELSEIF( SUBST( sAttributeConcatType,1,6 ) @= 'Type 2' );
        				sMyAttributeValue = sMyAttributeValue |' (' | vElement | ')';
    		    	ELSEIF( SUBST( sAttributeConcatType,1,6 ) @= 'Type 3' );
    				    sMyAttributeValue = vElement | ' ' | sMyAttributeValue;
        			ELSE;
        				# IF none of the above then just the Attribute (sMyAttributeValue). --> So nothing to do				
        			ENDIF;
        		ENDIF;
    			IF( nLoadAttrIndirectly = 1 );
    			    If( sMyCurrentAttributeLang @<> '' & DimIx( '}Cultures', sMyCurrentAttributeLang ) = 0 );
    			        ItemSkip;
    			    EndIf;
    			    If( DimIx( '}Cultures', sMyCurrentAttributeLang ) > 0 );
    			        sMyCurrentAttribute = Expand('%sMyCurrentAttribute%[%sMyCurrentAttributeLang%]');
    			        If( DimIx( cAttrDBDim, sMyCurrentAttribute ) = 0 );
    			            DimensionElementInsertDirect( cAttrDBDim, '', sMyCurrentAttribute, 'N' );
    			            DimensionElementComponentAddDirect( cAttrDBDim, 'Total APQ Dimension Attributes', sMyCurrentAttribute, 1 );
    			        EndIf;
    			    EndIf;
    			    IF( DType( sMyDimension, vElement ) @= 'N' & Scan( ':', sFinalDimension ) > 0 );
    			        sAttrDBHier = SubSt( sFinalDimension, 1, Scan( ':', sFinalDimension ) ) | 'Leaves';
    			    ELSE;
    			        sAttrDBHier = sFinalDimension;
    			    ENDIF;
    				CellPutS( sMyAttributeValue, cAttrDBCube, sAttrDBHier, vElement, sMyCurrentAttribute, 'Load Value' );
    			ELSE;
    
        			# If alternate hier then we need to address the hier in the element of cellisupdateable and dim of attrputs!
        			IF( sMyDimension @= sMyAttrDimension );
        			    IF( sMyCurrentAttributeLang @= '' );
            				IF( CellIsUpdateable( '}ElementAttributes_' | sMyAttrDimension, vElement, sMyCurrentAttribute ) = 1 );
            					IF( sMyCurrentAttributeType @= 'A' );
            						AttrPutS( sMyAttributeValue, sMyDimension, vElement, sMyCurrentAttribute, 1 );
            					ELSE;
            						AttrPutS( sMyAttributeValue, sMyDimension, vElement, sMyCurrentAttribute );
            					ENDIF;
            				ENDIF;
            			ELSEIF( DIMIX( '}Cultures', sMyCurrentAttributeLang ) > 0 );
            				IF( CubeExists( '}LocalizedElementAttributes_' | sMyAttrDimension ) = 0 );
            					IF( sMyCurrentAttributeType @= 'A' );
            						AttrPutS( sMyAttributeValue, sMyDimension, vElement, sMyCurrentAttribute, sMyCurrentAttributeLang, 1 );
            					ELSE;
            						AttrPutS( sMyAttributeValue, sMyDimension, vElement, sMyCurrentAttribute, sMyCurrentAttributeLang );
            					ENDIF;
            				ELSEIF( CellIsUpdateable( '}LocalizedElementAttributes_' | sMyAttrDimension, vElement, sMyCurrentAttributeLang, sMyCurrentAttribute ) = 1 );
            					IF( sMyCurrentAttributeType @= 'A' );
            						AttrPutS( sMyAttributeValue, sMyDimension, vElement, sMyCurrentAttribute, sMyCurrentAttributeLang, 1 );
            					ELSE;
            						AttrPutS( sMyAttributeValue, sMyDimension, vElement, sMyCurrentAttribute, sMyCurrentAttributeLang );
            					ENDIF;
            				ENDIF;
            			ENDIF;
        			ELSE;
        			    IF( sMyCurrentAttributeLang @= '' );
            				IF( CellIsUpdateable( '}ElementAttributes_' | sMyAttrDimension, sHier:vElement, sMyCurrentAttribute ) = 1 );
            					IF( sMyCurrentAttributeType @= 'A' );
            						AttrPutS( sMyAttributeValue, sMyDimension, vElement, sMyCurrentAttribute, 1 );
            					ELSE;
            						AttrPutS( sMyAttributeValue, sMyDimension, vElement, sMyCurrentAttribute );
            					ENDIF;
            				ENDIF;
            			ELSEIF( DIMIX( '}Cultures', sMyCurrentAttributeLang ) > 0 );
            				IF( CubeExists( '}LocalizedElementAttributes_' | sMyAttrDimension ) = 0 );
            					IF( sMyCurrentAttributeType @= 'A' );
            						AttrPutS( sMyAttributeValue, sMyDimension, vElement, sMyCurrentAttribute, sMyCurrentAttributeLang, 1 );
            					ELSE;
            						AttrPutS( sMyAttributeValue, sMyDimension, vElement, sMyCurrentAttribute, sMyCurrentAttributeLang );
            					ENDIF;
            				ELSEIF( CellIsUpdateable( '}LocalizedElementAttributes_' | sMyAttrDimension, sHier:vElement, sMyCurrentAttributeLang, sMyCurrentAttribute ) = 1 );
            					IF( sMyCurrentAttributeType @= 'A' );
            						AttrPutS( sMyAttributeValue, sMyDimension, vElement, sMyCurrentAttribute, sMyCurrentAttributeLang, 1 );
            					ELSE;
            						AttrPutS( sMyAttributeValue, sMyDimension, vElement, sMyCurrentAttribute, sMyCurrentAttributeLang );
            					ENDIF;
            				ENDIF;
            			ENDIF;
        			ENDIF;
    			ENDIF;
    		ENDIF;
    	ENDIF;
    	i = i + 1;
    END;
    #EndRegion - Attribute Management
    ##############################################################################################################
#EndRegion - Original source template (ByParentChild)
##############################################################################################################
ELSEIF( nNewTemplate = 1 );
##############################################################################################################
#Region - New source template (ByRollup)

    ### Skip Element empty
    IF( sSourceType @= 'CUBE' );
        IF( nValue = 0 );
        	ItemSkip;
        ELSE;
        	vDimName = v1;
        	vRowID   = v2;
        ENDIF;
    ENDIF;

    ##############################################################################################################
    #Region - Set variables
    ### Special case cube view data source need to read in variables
    IF( sSourceType @= 'CUBE' );
        vL1     = CellGetS( cCubSrc, vDimName, vRowID, 'vParent1' );
        vL2     = CellGetS( cCubSrc, vDimName, vRowID, 'vParent2' );
        vL3     = CellGetS( cCubSrc, vDimName, vRowID, 'vParent3' );
        vL4     = CellGetS( cCubSrc, vDimName, vRowID, 'vParent4' );
        vL5     = CellGetS( cCubSrc, vDimName, vRowID, 'vParent5' );
        vL6     = CellGetS( cCubSrc, vDimName, vRowID, 'vParent6' );
        vL7     = CellGetS( cCubSrc, vDimName, vRowID, 'vParent7' );
        vL8     = CellGetS( cCubSrc, vDimName, vRowID, 'vParent8' );
        vL9     = CellGetS( cCubSrc, vDimName, vRowID, 'vParent9' );
        vL10    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent10' );
        vL11    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent11' );
        vL12    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent12' );
        vL13    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent13' );
        vL14    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent14' );
        vL15    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent15' );
        vL16    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent16' );
        vL17    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent17' );
        vL18    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent18' );
        vL19    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent19' );
        vL20    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent20' );
        vL21    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent21' );
        vL22    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent22' );
        vL23    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent23' );
        vL24    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent24' );
        vL25    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent25' );
        vL26    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent26' );
        vL27    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent27' );
        vL28    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent28' );
        vL29    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent29' );
        vL30    = CellGetS( cCubSrc, vDimName, vRowID, 'vParent30' );
        vA1     = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute1' );
        vA2     = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute2' );
        vA3     = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute3' );
        vA4     = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute4' );
        vA5     = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute5' );
        vA6     = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute6' );
        vA7     = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute7' );
        vA8     = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute8' );
        vA9     = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute9' );
        vA10    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute10' );
        vA11    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute11' );
        vA12    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute12' );
        vA13    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute13' );
        vA14    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute14' );
        vA15    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute15' );
        vA16    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute16' );
        vA17    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute17' );
        vA18    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute18' );
        vA19    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute19' );
        vA20    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute20' );
        vA21    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute21' );
        vA22    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute22' );
        vA23    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute23' );
        vA24    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute24' );
        vA25    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute25' );
        vA26    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute26' );
        vA27    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute27' );
        vA28    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute28' );
        vA29    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute29' );
        vA30    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute30' );
        vA31    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute31' );
        vA32    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute32' );
        vA33    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute33' );
        vA34    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute34' );
        vA35    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute35' );
        vA36    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute36' );
        vA37    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute37' );
        vA38    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute38' );
        vA39    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute39' );
        vA40    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute40' );
        vA41    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute41' );
        vA42    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute42' );
        vA43    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute43' );
        vA44    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute44' );
        vA45    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute45' );
        vA46    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute46' );
        vA47    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute47' );
        vA48    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute48' );
        vA49    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute49' );
        vA50    = CellGetS( cCubSrc, vDimName, vRowID, 'vAttribute50' );
        ##############################################################################################################
        #Region - Set attribute name and type
        IF( nDataRecordCount = 1 );
            
        ENDIF;
        #EndRegion - Set attribute name and type
        ##############################################################################################################
    ENDIF;

    ### If ODBC then treat the string "NULL" the same as blank
    IF( sSourceType @= 'ODBC' );
    	vL1     = If( v1  @= 'NULL', '',  v1 );
    	vL2     = If( v2  @= 'NULL', '',  v2 );
    	vL3     = If( v3  @= 'NULL', '',  v3 );
    	vL4     = If( v4  @= 'NULL', '',  v4 );
    	vL5     = If( v5  @= 'NULL', '',  v5 );
    	vL6     = If( v6  @= 'NULL', '',  v6 );
    	vL7     = If( v7  @= 'NULL', '',  v7 );
    	vL8     = If( v8  @= 'NULL', '',  v8 );
    	vL9     = If( v9  @= 'NULL', '',  v9 );
    	vL10    = If( v10 @= 'NULL', '',  v10 );
    	vL11    = If( v11 @= 'NULL', '',  v11 );
    	vL12    = If( v12 @= 'NULL', '',  v12 );
    	vL13    = If( v13 @= 'NULL', '',  v13 );
    	vL14    = If( v14 @= 'NULL', '',  v14 );
    	vL15    = If( v15 @= 'NULL', '',  v15 );
    	vL16    = If( v16 @= 'NULL', '',  v16 );
    	vL17    = If( v17 @= 'NULL', '',  v17 );
    	vL18    = If( v18 @= 'NULL', '',  v18 );
    	vL19    = If( v19 @= 'NULL', '',  v19 );
    	vL20    = If( v20 @= 'NULL', '',  v20 );
    	vL21    = If( v21 @= 'NULL', '',  v21 );
    	vL22    = If( v22 @= 'NULL', '',  v22 );
    	vL23    = If( v23 @= 'NULL', '',  v23 );
    	vL24    = If( v24 @= 'NULL', '',  v24 );
    	vL25    = If( v25 @= 'NULL', '',  v25 );
    	vL26    = If( v26 @= 'NULL', '',  v26 );
    	vL27    = If( v27 @= 'NULL', '',  v27 );
    	vL28    = If( v28 @= 'NULL', '',  v28 );
    	vL29    = If( v29 @= 'NULL', '',  v29 );
    	vL30    = If( v30 @= 'NULL', '',  v30 );
    	vA1     = If( v33 @= 'NULL', '',  v33 );
    	vA2     = If( v34 @= 'NULL', '',  v34 );
    	vA3     = If( v35 @= 'NULL', '',  v35 );
    	vA4     = If( v36 @= 'NULL', '',  v36 );
    	vA5     = If( v37 @= 'NULL', '',  v37 );
    	vA6     = If( v38 @= 'NULL', '',  v38 );
    	vA7     = If( v39 @= 'NULL', '',  v39 );
    	vA8     = If( v40 @= 'NULL', '',  v40 );
    	vA9     = If( v41 @= 'NULL', '',  v41 );
    	vA10    = If( v42 @= 'NULL', '',  v42 );
    	vA11    = If( v43 @= 'NULL', '',  v43 );
    	vA12    = If( v44 @= 'NULL', '',  v44 );
    	vA13    = If( v45 @= 'NULL', '',  v45 );
    	vA14    = If( v46 @= 'NULL', '',  v46 );
    	vA15    = If( v47 @= 'NULL', '',  v47 );
    	vA16    = If( v48 @= 'NULL', '',  v48 );
    	vA17    = If( v49 @= 'NULL', '',  v49 );
    	vA18    = If( v50 @= 'NULL', '',  v50 );
    	vA19    = If( v51 @= 'NULL', '',  v51 );
    	vA20    = If( v52 @= 'NULL', '',  v52 );
    	vA21    = If( v53 @= 'NULL', '',  v53 );
    	vA22    = If( v54 @= 'NULL', '',  v54 );
    	vA23    = If( v55 @= 'NULL', '',  v55 );
    	vA24    = If( v56 @= 'NULL', '',  v56 );
    	vA25    = If( v57 @= 'NULL', '',  v57 );
    	vA26    = If( v58 @= 'NULL', '',  v58 );
    	vA27    = If( v59 @= 'NULL', '',  v59 );
    	vA28    = If( v60 @= 'NULL', '',  v60 );
    	vA29    = If( v61 @= 'NULL', '',  v61 );
    	vA30    = If( v62 @= 'NULL', '',  v62 );
    	vA31    = If( v63 @= 'NULL', '',  v63 );
    	vA32    = If( v64 @= 'NULL', '',  v64 );
    	vA33    = If( v65 @= 'NULL', '',  v65 );
    	vA34    = If( v66 @= 'NULL', '',  v66 );
    	vA35    = If( v67 @= 'NULL', '',  v67 );
    	vA36    = If( v68 @= 'NULL', '',  v68 );
    	vA37    = If( v69 @= 'NULL', '',  v69 );
    	vA38    = If( v70 @= 'NULL', '',  v70 );
    	vA39    = If( v71 @= 'NULL', '',  v71 );
    	vA40    = If( v72 @= 'NULL', '',  v72 );
    	vA41    = If( v73 @= 'NULL', '',  v73 );
    	vA42    = If( v74 @= 'NULL', '',  v74 );
    	vA43    = If( v75 @= 'NULL', '',  v75 );
    	vA44    = If( v76 @= 'NULL', '',  v76 );
    	vA45    = If( v77 @= 'NULL', '',  v77 );
    	vA46    = If( v78 @= 'NULL', '',  v78 );
    	vA47    = If( v79 @= 'NULL', '',  v79 );
    	vA48    = If( v80 @= 'NULL', '',  v80 );
    	vA49    = If( v81 @= 'NULL', '',  v81 );
    	vA50    = If( v82 @= 'NULL', '',  v82 );
    ENDIF;
    
    ### If text then trim
    IF( sSourceType @= 'CSV' );
    	vL1     = Trim( v2 );
    	vL2     = Trim( v3 );
    	vL3     = Trim( v4 );
    	vL4     = Trim( v5 );
    	vL5     = Trim( v6 );
    	vL6     = Trim( v7 );
    	vL7     = Trim( v8 );
    	vL8     = Trim( v9 );
    	vL9     = Trim( v10 );
    	vL10    = Trim( v11 );
    	vL11    = Trim( v12 );
    	vL12    = Trim( v13 );
    	vL13    = Trim( v14 );
    	vL14    = Trim( v15 );
    	vL15    = Trim( v16 );
    	vL16    = Trim( v17 );
    	vL17    = Trim( v18 );
    	vL18    = Trim( v19 );
    	vL19    = Trim( v20 );
    	vL20    = Trim( v21 );
    	vL21    = Trim( v22 );
    	vL22    = Trim( v23 );
    	vL23    = Trim( v24 );
    	vL24    = Trim( v25 );
    	vL25    = Trim( v26 );
    	vL26    = Trim( v27 );
    	vL27    = Trim( v28 );
    	vL28    = Trim( v29 );
    	vL29    = Trim( v30 );
    	vL30    = Trim( v31 );
    	vA1     = Trim( v34 );
    	vA2     = Trim( v35 );
    	vA3     = Trim( v36 );
    	vA4     = Trim( v37 );
    	vA5     = Trim( v38 );
    	vA6     = Trim( v39 );
    	vA7     = Trim( v40 );
    	vA8     = Trim( v41 );
    	vA9     = Trim( v42 );
    	vA10    = Trim( v43 );
    	vA11    = Trim( v44 );
    	vA12    = Trim( v45 );
    	vA13    = Trim( v46 );
    	vA14    = Trim( v47 );
    	vA15    = Trim( v48 );
    	vA16    = Trim( v49 );
    	vA17    = Trim( v50 );
    	vA18    = Trim( v51 );
    	vA19    = Trim( v52 );
    	vA20    = Trim( v53 );
    	vA21    = Trim( v54 );
    	vA22    = Trim( v55 );
    	vA23    = Trim( v56 );
    	vA24    = Trim( v57 );
    	vA25    = Trim( v58 );
    	vA26    = Trim( v59 );
    	vA27    = Trim( v60 );
    	vA28    = Trim( v61 );
    	vA29    = Trim( v62 );
    	vA30    = Trim( v63 );
    	vA31    = Trim( v64 );
    	vA32    = Trim( v65 );
    	vA33    = Trim( v66 );
    	vA34    = Trim( v67 );
    	vA35    = Trim( v68 );
    	vA36    = Trim( v69 );
    	vA37    = Trim( v70 );
    	vA38    = Trim( v71 );
    	vA39    = Trim( v72 );
    	vA40    = Trim( v73 );
    	vA41    = Trim( v74 );
    	vA42    = Trim( v75 );
    	vA43    = Trim( v76 );
    	vA44    = Trim( v77 );
    	vA45    = Trim( v78 );
    	vA46    = Trim( v79 );
    	vA47    = Trim( v80 );
    	vA48    = Trim( v81 );
    	vA49    = Trim( v82 );
    	vA50    = Trim( v83 );
    ENDIF;
    #EndRegion - Set variables
    ##############################################################################################################
    
    ##############################################################################################################
    #Region - For each record determine which level holds element value and which level is parent
    If( vL1 @<> '' );
        sEle    = vL1;
    ElseIf( vL2 @<> '' );
        sEle    = vL2;
    ElseIf( vL3 @<> '' );
        sEle    = vL3;
    ElseIf( vL4 @<> '' );
        sEle    = vL4;
    ElseIf( vL5 @<> '' );
        sEle    = vL5;
    ElseIf( vL6 @<> '' );
        sEle    = vL6;
    ElseIf( vL7 @<> '' );
        sEle    = vL7;
    ElseIf( vL8 @<> '' );
        sEle    = vL8;
    ElseIf( vL9 @<> '' );
        sEle    = vL9;
    ElseIf( vL10 @<> '' );
        sEle    = vL10;
    ElseIf( vL11 @<> '' );
        sEle    = vL11;
    ElseIf( vL12 @<> '' );
        sEle    = vL12;
    ElseIf( vL13 @<> '' );
        sEle    = vL13;
    ElseIf( vL14 @<> '' );
        sEle    = vL14;
    ElseIf( vL15 @<> '' );
        sEle    = vL15;
    ElseIf( vL16 @<> '' );
        sEle    = vL16;
    ElseIf( vL17 @<> '' );
        sEle    = vL17;
    ElseIf( vL18 @<> '' );
        sEle    = vL18;
    ElseIf( vL19 @<> '' );
        sEle    = vL19;
    ElseIf( vL20 @<> '' );
        sEle    = vL20;
    ElseIf( vL21 @<> '' );
        sEle    = vL21;
    ElseIf( vL22 @<> '' );
        sEle    = vL22;
    ElseIf( vL23 @<> '' );
        sEle    = vL23;
    ElseIf( vL24 @<> '' );
        sEle    = vL24;
    ElseIf( vL25 @<> '' );
        sEle    = vL25;
    ElseIf( vL26 @<> '' );
        sEle    = vL26;
    ElseIf( vL27 @<> '' );
        sEle    = vL27;
    ElseIf( vL28 @<> '' );
        sEle    = vL28;
    ElseIf( vL29 @<> '' );
        sEle    = vL29;
    ElseIf( vL30 @<> '' );
        sEle    = vL30;
    EndIf;
    #EndRegion - For each record determine which level holds element value and which level is parent
    ##############################################################################################################

    ### Allow mapping input to contain alias names rather than principal names
    ### (must check on sFinalDimension not sMyDimension in case of multi-step load with }Temp dimension)
    If( nAliasAsElement = 1 );
        If( DimIx( sFinalDimension, sEle ) > 0 );
            sEle = DimensionElementPrincipalName( sFinalDimension, sEle );
        EndIf;
    EndIf;
    
    ##############################################################################################################
    #Region - Get attribute names and types 
    If( nDataRecordCount = 1 );
        If( sSourceType @= 'CUBE' );
            vAttrHd1    = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute1' );
            vAttrHd2    = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute2' );
            vAttrHd3    = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute3' );
            vAttrHd4    = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute4' );
            vAttrHd5    = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute5' );
            vAttrHd6    = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute6' );
            vAttrHd7    = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute7' );
            vAttrHd8    = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute8' );
            vAttrHd9    = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute9' );
            vAttrHd10   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute10' );
            vAttrHd11   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute11' );
            vAttrHd12   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute12' );
            vAttrHd13   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute13' );
            vAttrHd14   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute14' );
            vAttrHd15   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute15' );
            vAttrHd16   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute16' );
            vAttrHd17   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute17' );
            vAttrHd18   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute18' );
            vAttrHd19   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute19' );
            vAttrHd20   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute20' );
            vAttrHd21   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute21' );
            vAttrHd22   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute22' );
            vAttrHd23   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute23' );
            vAttrHd24   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute24' );
            vAttrHd25   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute25' );
            vAttrHd26   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute26' );
            vAttrHd27   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute27' );
            vAttrHd28   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute28' );
            vAttrHd29   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute29' );
            vAttrHd30   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute30' );
            vAttrHd31   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute31' );
            vAttrHd32   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute32' );
            vAttrHd33   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute33' );
            vAttrHd34   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute34' );
            vAttrHd35   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute35' );
            vAttrHd36   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute36' );
            vAttrHd37   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute37' );
            vAttrHd38   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute38' );
            vAttrHd39   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute39' );
            vAttrHd40   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute40' );
            vAttrHd41   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute41' );
            vAttrHd42   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute42' );
            vAttrHd43   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute43' );
            vAttrHd44   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute44' );
            vAttrHd45   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute45' );
            vAttrHd46   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute46' );
            vAttrHd47   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute47' );
            vAttrHd48   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute48' );
            vAttrHd49   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute49' );
            vAttrHd50   = CellGetS( cCubSrc, vDimName, 'Total Rows', 'vAttribute50' );
        Else;
            vAttrHd1    = vA1;
            vAttrHd2    = vA2;
            vAttrHd3    = vA3;
            vAttrHd4    = vA4;
            vAttrHd5    = vA5;
            vAttrHd6    = vA6;
            vAttrHd7    = vA7;
            vAttrHd8    = vA8;
            vAttrHd9    = vA9;
            vAttrHd10   = vA10;
            vAttrHd11   = vA11;
            vAttrHd12   = vA12;
            vAttrHd13   = vA13;
            vAttrHd14   = vA14;
            vAttrHd15   = vA15;
            vAttrHd16   = vA16;
            vAttrHd17   = vA17;
            vAttrHd18   = vA18;
            vAttrHd19   = vA19;
            vAttrHd20   = vA20;
            vAttrHd21   = vA21;
            vAttrHd22   = vA22;
            vAttrHd23   = vA23;
            vAttrHd24   = vA24;
            vAttrHd25   = vA25;
            vAttrHd26   = vA26;
            vAttrHd27   = vA27;
            vAttrHd28   = vA28;
            vAttrHd29   = vA29;
            vAttrHd30   = vA30;
            vAttrHd31   = vA31;
            vAttrHd32   = vA32;
            vAttrHd33   = vA33;
            vAttrHd34   = vA34;
            vAttrHd35   = vA35;
            vAttrHd36   = vA36;
            vAttrHd37   = vA37;
            vAttrHd38   = vA38;
            vAttrHd39   = vA39;
            vAttrHd40   = vA40;
            vAttrHd41   = vA41;
            vAttrHd42   = vA42;
            vAttrHd43   = vA43;
            vAttrHd44   = vA44;
            vAttrHd45   = vA45;
            vAttrHd46   = vA46;
            vAttrHd47   = vA47;
            vAttrHd48   = vA48;
            vAttrHd49   = vA49;
            vAttrHd50   = vA50;
        EndIf;
        vAttrTyp1       = SubSt( vAttrHd1,  2, 1 ); vAttrNm1  = Trim( SubSt( vAttrHd1,  Scan( ']', vAttrHd1  ) + 1, Long( vAttrHd1  ) ) ); vAttrLan1  = If( SubSt( vAttrNm1,  1, 1 ) @<> '[', '', SubSt( vAttrNm1,  2, Scan( ']', vAttrNm1 ) -  2 ) ); vAttrNm1  = If( SubSt( vAttrNm1,  1, 1 ) @<> '[', vAttrNm1,  Trim( SubSt( vAttrNm1,  Scan( ']', vAttrNm1 )  + 1, Long( vAttrNm1  ) ) ) );
        vAttrTyp2       = SubSt( vAttrHd2,  2, 1 ); vAttrNm2  = Trim( SubSt( vAttrHd2,  Scan( ']', vAttrHd2  ) + 1, Long( vAttrHd2  ) ) ); vAttrLan2  = If( SubSt( vAttrNm2,  1, 1 ) @<> '[', '', SubSt( vAttrNm2,  2, Scan( ']', vAttrNm2 ) -  2 ) ); vAttrNm2  = If( SubSt( vAttrNm2,  1, 1 ) @<> '[', vAttrNm2,  Trim( SubSt( vAttrNm2,  Scan( ']', vAttrNm2 )  + 1, Long( vAttrNm2  ) ) ) );
        vAttrTyp3       = SubSt( vAttrHd3,  2, 1 ); vAttrNm3  = Trim( SubSt( vAttrHd3,  Scan( ']', vAttrHd3  ) + 1, Long( vAttrHd3  ) ) ); vAttrLan3  = If( SubSt( vAttrNm3,  1, 1 ) @<> '[', '', SubSt( vAttrNm3,  2, Scan( ']', vAttrNm3 ) -  2 ) ); vAttrNm3  = If( SubSt( vAttrNm3,  1, 1 ) @<> '[', vAttrNm3,  Trim( SubSt( vAttrNm3,  Scan( ']', vAttrNm3 )  + 1, Long( vAttrNm3  ) ) ) );
        vAttrTyp4       = SubSt( vAttrHd4,  2, 1 ); vAttrNm4  = Trim( SubSt( vAttrHd4,  Scan( ']', vAttrHd4  ) + 1, Long( vAttrHd4  ) ) ); vAttrLan4  = If( SubSt( vAttrNm4,  1, 1 ) @<> '[', '', SubSt( vAttrNm4,  2, Scan( ']', vAttrNm4 ) -  2 ) ); vAttrNm4  = If( SubSt( vAttrNm4,  1, 1 ) @<> '[', vAttrNm4,  Trim( SubSt( vAttrNm4,  Scan( ']', vAttrNm4 )  + 1, Long( vAttrNm4  ) ) ) );
        vAttrTyp5       = SubSt( vAttrHd5,  2, 1 ); vAttrNm5  = Trim( SubSt( vAttrHd5,  Scan( ']', vAttrHd5  ) + 1, Long( vAttrHd5  ) ) ); vAttrLan5  = If( SubSt( vAttrNm5,  1, 1 ) @<> '[', '', SubSt( vAttrNm5,  2, Scan( ']', vAttrNm5 ) -  2 ) ); vAttrNm5  = If( SubSt( vAttrNm5,  1, 1 ) @<> '[', vAttrNm5,  Trim( SubSt( vAttrNm5,  Scan( ']', vAttrNm5 )  + 1, Long( vAttrNm5  ) ) ) );
        vAttrTyp6       = SubSt( vAttrHd6,  2, 1 ); vAttrNm6  = Trim( SubSt( vAttrHd6,  Scan( ']', vAttrHd6  ) + 1, Long( vAttrHd6  ) ) ); vAttrLan6  = If( SubSt( vAttrNm6,  1, 1 ) @<> '[', '', SubSt( vAttrNm6,  2, Scan( ']', vAttrNm6 ) -  2 ) ); vAttrNm6  = If( SubSt( vAttrNm6,  1, 1 ) @<> '[', vAttrNm6,  Trim( SubSt( vAttrNm6,  Scan( ']', vAttrNm6 )  + 1, Long( vAttrNm6  ) ) ) );
        vAttrTyp7       = SubSt( vAttrHd7,  2, 1 ); vAttrNm7  = Trim( SubSt( vAttrHd7,  Scan( ']', vAttrHd7  ) + 1, Long( vAttrHd7  ) ) ); vAttrLan7  = If( SubSt( vAttrNm7,  1, 1 ) @<> '[', '', SubSt( vAttrNm7,  2, Scan( ']', vAttrNm7 ) -  2 ) ); vAttrNm7  = If( SubSt( vAttrNm7,  1, 1 ) @<> '[', vAttrNm7,  Trim( SubSt( vAttrNm7,  Scan( ']', vAttrNm7 )  + 1, Long( vAttrNm7  ) ) ) );
        vAttrTyp8       = SubSt( vAttrHd8,  2, 1 ); vAttrNm8  = Trim( SubSt( vAttrHd8,  Scan( ']', vAttrHd8  ) + 1, Long( vAttrHd8  ) ) ); vAttrLan8  = If( SubSt( vAttrNm8,  1, 1 ) @<> '[', '', SubSt( vAttrNm8,  2, Scan( ']', vAttrNm8 ) -  2 ) ); vAttrNm8  = If( SubSt( vAttrNm8,  1, 1 ) @<> '[', vAttrNm8,  Trim( SubSt( vAttrNm8,  Scan( ']', vAttrNm8 )  + 1, Long( vAttrNm8  ) ) ) );
        vAttrTyp9       = SubSt( vAttrHd9,  2, 1 ); vAttrNm9  = Trim( SubSt( vAttrHd9,  Scan( ']', vAttrHd9  ) + 1, Long( vAttrHd9  ) ) ); vAttrLan9  = If( SubSt( vAttrNm9,  1, 1 ) @<> '[', '', SubSt( vAttrNm9,  2, Scan( ']', vAttrNm9  ) - 2 ) ); vAttrNm9  = If( SubSt( vAttrNm9,  1, 1 ) @<> '[', vAttrNm9,  Trim( SubSt( vAttrNm9,  Scan( ']', vAttrNm9  ) + 1, Long( vAttrNm9  ) ) ) );
        vAttrTyp10      = SubSt( vAttrHd10, 2, 1 ); vAttrNm10 = Trim( SubSt( vAttrHd10, Scan( ']', vAttrHd10 ) + 1, Long( vAttrHd10 ) ) ); vAttrLan10 = If( SubSt( vAttrNm10, 1, 1 ) @<> '[', '', SubSt( vAttrNm10, 2, Scan( ']', vAttrNm10 ) - 2 ) ); vAttrNm10 = If( SubSt( vAttrNm10, 1, 1 ) @<> '[', vAttrNm10, Trim( SubSt( vAttrNm10, Scan( ']', vAttrNm10 ) + 1, Long( vAttrNm10 ) ) ) );
        vAttrTyp11      = SubSt( vAttrHd11, 2, 1 ); vAttrNm11 = Trim( SubSt( vAttrHd11, Scan( ']', vAttrHd11 ) + 1, Long( vAttrHd11 ) ) ); vAttrLan11 = If( SubSt( vAttrNm11, 1, 1 ) @<> '[', '', SubSt( vAttrNm11, 2, Scan( ']', vAttrNm11 ) - 2 ) ); vAttrNm11 = If( SubSt( vAttrNm11, 1, 1 ) @<> '[', vAttrNm11, Trim( SubSt( vAttrNm11, Scan( ']', vAttrNm11 ) + 1, Long( vAttrNm11 ) ) ) );
        vAttrTyp12      = SubSt( vAttrHd12, 2, 1 ); vAttrNm12 = Trim( SubSt( vAttrHd12, Scan( ']', vAttrHd12 ) + 1, Long( vAttrHd12 ) ) ); vAttrLan12 = If( SubSt( vAttrNm12, 1, 1 ) @<> '[', '', SubSt( vAttrNm12, 2, Scan( ']', vAttrNm12 ) - 2 ) ); vAttrNm12 = If( SubSt( vAttrNm12, 1, 1 ) @<> '[', vAttrNm12, Trim( SubSt( vAttrNm12, Scan( ']', vAttrNm12 ) + 1, Long( vAttrNm12 ) ) ) );
        vAttrTyp13      = SubSt( vAttrHd13, 2, 1 ); vAttrNm13 = Trim( SubSt( vAttrHd13, Scan( ']', vAttrHd13 ) + 1, Long( vAttrHd13 ) ) ); vAttrLan13 = If( SubSt( vAttrNm13, 1, 1 ) @<> '[', '', SubSt( vAttrNm13, 2, Scan( ']', vAttrNm13 ) - 2 ) ); vAttrNm13 = If( SubSt( vAttrNm13, 1, 1 ) @<> '[', vAttrNm13, Trim( SubSt( vAttrNm13, Scan( ']', vAttrNm13 ) + 1, Long( vAttrNm13 ) ) ) );
        vAttrTyp14      = SubSt( vAttrHd14, 2, 1 ); vAttrNm14 = Trim( SubSt( vAttrHd14, Scan( ']', vAttrHd14 ) + 1, Long( vAttrHd14 ) ) ); vAttrLan14 = If( SubSt( vAttrNm14, 1, 1 ) @<> '[', '', SubSt( vAttrNm14, 2, Scan( ']', vAttrNm14 ) - 2 ) ); vAttrNm14 = If( SubSt( vAttrNm14, 1, 1 ) @<> '[', vAttrNm14, Trim( SubSt( vAttrNm14, Scan( ']', vAttrNm14 ) + 1, Long( vAttrNm14 ) ) ) );
        vAttrTyp15      = SubSt( vAttrHd15, 2, 1 ); vAttrNm15 = Trim( SubSt( vAttrHd15, Scan( ']', vAttrHd15 ) + 1, Long( vAttrHd15 ) ) ); vAttrLan15 = If( SubSt( vAttrNm15, 1, 1 ) @<> '[', '', SubSt( vAttrNm15, 2, Scan( ']', vAttrNm15 ) - 2 ) ); vAttrNm15 = If( SubSt( vAttrNm15, 1, 1 ) @<> '[', vAttrNm15, Trim( SubSt( vAttrNm15, Scan( ']', vAttrNm15 ) + 1, Long( vAttrNm15 ) ) ) );
        vAttrTyp16      = SubSt( vAttrHd16, 2, 1 ); vAttrNm16 = Trim( SubSt( vAttrHd16, Scan( ']', vAttrHd16 ) + 1, Long( vAttrHd16 ) ) ); vAttrLan16 = If( SubSt( vAttrNm16, 1, 1 ) @<> '[', '', SubSt( vAttrNm16, 2, Scan( ']', vAttrNm16 ) - 2 ) ); vAttrNm16 = If( SubSt( vAttrNm16, 1, 1 ) @<> '[', vAttrNm16, Trim( SubSt( vAttrNm16, Scan( ']', vAttrNm16 ) + 1, Long( vAttrNm16 ) ) ) );
        vAttrTyp17      = SubSt( vAttrHd17, 2, 1 ); vAttrNm17 = Trim( SubSt( vAttrHd17, Scan( ']', vAttrHd17 ) + 1, Long( vAttrHd17 ) ) ); vAttrLan17 = If( SubSt( vAttrNm17, 1, 1 ) @<> '[', '', SubSt( vAttrNm17, 2, Scan( ']', vAttrNm17 ) - 2 ) ); vAttrNm17 = If( SubSt( vAttrNm17, 1, 1 ) @<> '[', vAttrNm17, Trim( SubSt( vAttrNm17, Scan( ']', vAttrNm17 ) + 1, Long( vAttrNm17 ) ) ) );
        vAttrTyp18      = SubSt( vAttrHd18, 2, 1 ); vAttrNm18 = Trim( SubSt( vAttrHd18, Scan( ']', vAttrHd18 ) + 1, Long( vAttrHd18 ) ) ); vAttrLan18 = If( SubSt( vAttrNm18, 1, 1 ) @<> '[', '', SubSt( vAttrNm18, 2, Scan( ']', vAttrNm18 ) - 2 ) ); vAttrNm18 = If( SubSt( vAttrNm18, 1, 1 ) @<> '[', vAttrNm18, Trim( SubSt( vAttrNm18, Scan( ']', vAttrNm18 ) + 1, Long( vAttrNm18 ) ) ) );
        vAttrTyp19      = SubSt( vAttrHd19, 2, 1 ); vAttrNm19 = Trim( SubSt( vAttrHd19, Scan( ']', vAttrHd19 ) + 1, Long( vAttrHd19 ) ) ); vAttrLan19 = If( SubSt( vAttrNm19, 1, 1 ) @<> '[', '', SubSt( vAttrNm19, 2, Scan( ']', vAttrNm19 ) - 2 ) ); vAttrNm19 = If( SubSt( vAttrNm19, 1, 1 ) @<> '[', vAttrNm19, Trim( SubSt( vAttrNm19, Scan( ']', vAttrNm19 ) + 1, Long( vAttrNm19 ) ) ) );
        vAttrTyp20      = SubSt( vAttrHd20, 2, 1 ); vAttrNm20 = Trim( SubSt( vAttrHd20, Scan( ']', vAttrHd20 ) + 1, Long( vAttrHd20 ) ) ); vAttrLan20 = If( SubSt( vAttrNm20, 1, 1 ) @<> '[', '', SubSt( vAttrNm20, 2, Scan( ']', vAttrNm20 ) - 2 ) ); vAttrNm20 = If( SubSt( vAttrNm20, 1, 1 ) @<> '[', vAttrNm20, Trim( SubSt( vAttrNm20, Scan( ']', vAttrNm20 ) + 1, Long( vAttrNm20 ) ) ) );
        vAttrTyp21      = SubSt( vAttrHd21, 2, 1 ); vAttrNm21 = Trim( SubSt( vAttrHd21, Scan( ']', vAttrHd21 ) + 1, Long( vAttrHd21 ) ) ); vAttrLan21 = If( SubSt( vAttrNm21, 1, 1 ) @<> '[', '', SubSt( vAttrNm21, 2, Scan( ']', vAttrNm21 ) - 2 ) ); vAttrNm21 = If( SubSt( vAttrNm21, 1, 1 ) @<> '[', vAttrNm21, Trim( SubSt( vAttrNm21, Scan( ']', vAttrNm21 ) + 1, Long( vAttrNm21 ) ) ) );
        vAttrTyp22      = SubSt( vAttrHd22, 2, 1 ); vAttrNm22 = Trim( SubSt( vAttrHd22, Scan( ']', vAttrHd22 ) + 1, Long( vAttrHd22 ) ) ); vAttrLan22 = If( SubSt( vAttrNm22, 1, 1 ) @<> '[', '', SubSt( vAttrNm22, 2, Scan( ']', vAttrNm22 ) - 2 ) ); vAttrNm22 = If( SubSt( vAttrNm22, 1, 1 ) @<> '[', vAttrNm22, Trim( SubSt( vAttrNm22, Scan( ']', vAttrNm22 ) + 1, Long( vAttrNm22 ) ) ) );
        vAttrTyp23      = SubSt( vAttrHd23, 2, 1 ); vAttrNm23 = Trim( SubSt( vAttrHd23, Scan( ']', vAttrHd23 ) + 1, Long( vAttrHd23 ) ) ); vAttrLan23 = If( SubSt( vAttrNm23, 1, 1 ) @<> '[', '', SubSt( vAttrNm23, 2, Scan( ']', vAttrNm23 ) - 2 ) ); vAttrNm23 = If( SubSt( vAttrNm23, 1, 1 ) @<> '[', vAttrNm23, Trim( SubSt( vAttrNm23, Scan( ']', vAttrNm23 ) + 1, Long( vAttrNm23 ) ) ) );
        vAttrTyp24      = SubSt( vAttrHd24, 2, 1 ); vAttrNm24 = Trim( SubSt( vAttrHd24, Scan( ']', vAttrHd24 ) + 1, Long( vAttrHd24 ) ) ); vAttrLan24 = If( SubSt( vAttrNm24, 1, 1 ) @<> '[', '', SubSt( vAttrNm24, 2, Scan( ']', vAttrNm24 ) - 2 ) ); vAttrNm24 = If( SubSt( vAttrNm24, 1, 1 ) @<> '[', vAttrNm24, Trim( SubSt( vAttrNm24, Scan( ']', vAttrNm24 ) + 1, Long( vAttrNm24 ) ) ) );
        vAttrTyp25      = SubSt( vAttrHd25, 2, 1 ); vAttrNm25 = Trim( SubSt( vAttrHd25, Scan( ']', vAttrHd25 ) + 1, Long( vAttrHd25 ) ) ); vAttrLan25 = If( SubSt( vAttrNm25, 1, 1 ) @<> '[', '', SubSt( vAttrNm25, 2, Scan( ']', vAttrNm25 ) - 2 ) ); vAttrNm25 = If( SubSt( vAttrNm25, 1, 1 ) @<> '[', vAttrNm25, Trim( SubSt( vAttrNm25, Scan( ']', vAttrNm25 ) + 1, Long( vAttrNm25 ) ) ) );
        vAttrTyp26      = SubSt( vAttrHd26, 2, 1 ); vAttrNm26 = Trim( SubSt( vAttrHd26, Scan( ']', vAttrHd26 ) + 1, Long( vAttrHd26 ) ) ); vAttrLan26 = If( SubSt( vAttrNm26, 1, 1 ) @<> '[', '', SubSt( vAttrNm26, 2, Scan( ']', vAttrNm26 ) - 2 ) ); vAttrNm26 = If( SubSt( vAttrNm26, 1, 1 ) @<> '[', vAttrNm26, Trim( SubSt( vAttrNm26, Scan( ']', vAttrNm26 ) + 1, Long( vAttrNm26 ) ) ) );
        vAttrTyp27      = SubSt( vAttrHd27, 2, 1 ); vAttrNm27 = Trim( SubSt( vAttrHd27, Scan( ']', vAttrHd27 ) + 1, Long( vAttrHd27 ) ) ); vAttrLan27 = If( SubSt( vAttrNm27, 1, 1 ) @<> '[', '', SubSt( vAttrNm27, 2, Scan( ']', vAttrNm27 ) - 2 ) ); vAttrNm27 = If( SubSt( vAttrNm27, 1, 1 ) @<> '[', vAttrNm27, Trim( SubSt( vAttrNm27, Scan( ']', vAttrNm27 ) + 1, Long( vAttrNm27 ) ) ) );
        vAttrTyp28      = SubSt( vAttrHd28, 2, 1 ); vAttrNm28 = Trim( SubSt( vAttrHd28, Scan( ']', vAttrHd28 ) + 1, Long( vAttrHd28 ) ) ); vAttrLan28 = If( SubSt( vAttrNm28, 1, 1 ) @<> '[', '', SubSt( vAttrNm28, 2, Scan( ']', vAttrNm28 ) - 2 ) ); vAttrNm28 = If( SubSt( vAttrNm28, 1, 1 ) @<> '[', vAttrNm28, Trim( SubSt( vAttrNm28, Scan( ']', vAttrNm28 ) + 1, Long( vAttrNm28 ) ) ) );
        vAttrTyp29      = SubSt( vAttrHd29, 2, 1 ); vAttrNm29 = Trim( SubSt( vAttrHd29, Scan( ']', vAttrHd29 ) + 1, Long( vAttrHd29 ) ) ); vAttrLan29 = If( SubSt( vAttrNm29, 1, 1 ) @<> '[', '', SubSt( vAttrNm29, 2, Scan( ']', vAttrNm29 ) - 2 ) ); vAttrNm29 = If( SubSt( vAttrNm29, 1, 1 ) @<> '[', vAttrNm29, Trim( SubSt( vAttrNm29, Scan( ']', vAttrNm29 ) + 1, Long( vAttrNm29 ) ) ) );
        vAttrTyp30      = SubSt( vAttrHd30, 2, 1 ); vAttrNm30 = Trim( SubSt( vAttrHd30, Scan( ']', vAttrHd30 ) + 1, Long( vAttrHd30 ) ) ); vAttrLan30 = If( SubSt( vAttrNm30, 1, 1 ) @<> '[', '', SubSt( vAttrNm30, 2, Scan( ']', vAttrNm30 ) - 2 ) ); vAttrNm30 = If( SubSt( vAttrNm30, 1, 1 ) @<> '[', vAttrNm30, Trim( SubSt( vAttrNm30, Scan( ']', vAttrNm30 ) + 1, Long( vAttrNm30 ) ) ) );
        vAttrTyp31      = SubSt( vAttrHd31, 2, 1 ); vAttrNm31 = Trim( SubSt( vAttrHd31, Scan( ']', vAttrHd31 ) + 1, Long( vAttrHd31 ) ) ); vAttrLan31 = If( SubSt( vAttrNm31, 1, 1 ) @<> '[', '', SubSt( vAttrNm31, 2, Scan( ']', vAttrNm31 ) - 2 ) ); vAttrNm31 = If( SubSt( vAttrNm31, 1, 1 ) @<> '[', vAttrNm31, Trim( SubSt( vAttrNm31, Scan( ']', vAttrNm31 ) + 1, Long( vAttrNm31 ) ) ) );
        vAttrTyp32      = SubSt( vAttrHd32, 2, 1 ); vAttrNm32 = Trim( SubSt( vAttrHd32, Scan( ']', vAttrHd32 ) + 1, Long( vAttrHd32 ) ) ); vAttrLan32 = If( SubSt( vAttrNm32, 1, 1 ) @<> '[', '', SubSt( vAttrNm32, 2, Scan( ']', vAttrNm32 ) - 2 ) ); vAttrNm32 = If( SubSt( vAttrNm32, 1, 1 ) @<> '[', vAttrNm32, Trim( SubSt( vAttrNm32, Scan( ']', vAttrNm32 ) + 1, Long( vAttrNm32 ) ) ) );
        vAttrTyp33      = SubSt( vAttrHd33, 2, 1 ); vAttrNm33 = Trim( SubSt( vAttrHd33, Scan( ']', vAttrHd33 ) + 1, Long( vAttrHd33 ) ) ); vAttrLan33 = If( SubSt( vAttrNm33, 1, 1 ) @<> '[', '', SubSt( vAttrNm33, 2, Scan( ']', vAttrNm33 ) - 2 ) ); vAttrNm33 = If( SubSt( vAttrNm33, 1, 1 ) @<> '[', vAttrNm33, Trim( SubSt( vAttrNm33, Scan( ']', vAttrNm33 ) + 1, Long( vAttrNm33 ) ) ) );
        vAttrTyp34      = SubSt( vAttrHd34, 2, 1 ); vAttrNm34 = Trim( SubSt( vAttrHd34, Scan( ']', vAttrHd34 ) + 1, Long( vAttrHd34 ) ) ); vAttrLan34 = If( SubSt( vAttrNm34, 1, 1 ) @<> '[', '', SubSt( vAttrNm34, 2, Scan( ']', vAttrNm34 ) - 2 ) ); vAttrNm34 = If( SubSt( vAttrNm34, 1, 1 ) @<> '[', vAttrNm34, Trim( SubSt( vAttrNm34, Scan( ']', vAttrNm34 ) + 1, Long( vAttrNm34 ) ) ) );
        vAttrTyp35      = SubSt( vAttrHd35, 2, 1 ); vAttrNm35 = Trim( SubSt( vAttrHd35, Scan( ']', vAttrHd35 ) + 1, Long( vAttrHd35 ) ) ); vAttrLan35 = If( SubSt( vAttrNm35, 1, 1 ) @<> '[', '', SubSt( vAttrNm35, 2, Scan( ']', vAttrNm35 ) - 2 ) ); vAttrNm35 = If( SubSt( vAttrNm35, 1, 1 ) @<> '[', vAttrNm35, Trim( SubSt( vAttrNm35, Scan( ']', vAttrNm35 ) + 1, Long( vAttrNm35 ) ) ) );
        vAttrTyp36      = SubSt( vAttrHd36, 2, 1 ); vAttrNm36 = Trim( SubSt( vAttrHd36, Scan( ']', vAttrHd36 ) + 1, Long( vAttrHd36 ) ) ); vAttrLan36 = If( SubSt( vAttrNm36, 1, 1 ) @<> '[', '', SubSt( vAttrNm36, 2, Scan( ']', vAttrNm36 ) - 2 ) ); vAttrNm36 = If( SubSt( vAttrNm36, 1, 1 ) @<> '[', vAttrNm36, Trim( SubSt( vAttrNm36, Scan( ']', vAttrNm36 ) + 1, Long( vAttrNm36 ) ) ) );
        vAttrTyp37      = SubSt( vAttrHd37, 2, 1 ); vAttrNm37 = Trim( SubSt( vAttrHd37, Scan( ']', vAttrHd37 ) + 1, Long( vAttrHd37 ) ) ); vAttrLan37 = If( SubSt( vAttrNm37, 1, 1 ) @<> '[', '', SubSt( vAttrNm37, 2, Scan( ']', vAttrNm37 ) - 2 ) ); vAttrNm37 = If( SubSt( vAttrNm37, 1, 1 ) @<> '[', vAttrNm37, Trim( SubSt( vAttrNm37, Scan( ']', vAttrNm37 ) + 1, Long( vAttrNm37 ) ) ) );
        vAttrTyp38      = SubSt( vAttrHd38, 2, 1 ); vAttrNm38 = Trim( SubSt( vAttrHd38, Scan( ']', vAttrHd38 ) + 1, Long( vAttrHd38 ) ) ); vAttrLan38 = If( SubSt( vAttrNm38, 1, 1 ) @<> '[', '', SubSt( vAttrNm38, 2, Scan( ']', vAttrNm38 ) - 2 ) ); vAttrNm38 = If( SubSt( vAttrNm38, 1, 1 ) @<> '[', vAttrNm38, Trim( SubSt( vAttrNm38, Scan( ']', vAttrNm38 ) + 1, Long( vAttrNm38 ) ) ) );
        vAttrTyp39      = SubSt( vAttrHd39, 2, 1 ); vAttrNm39 = Trim( SubSt( vAttrHd39, Scan( ']', vAttrHd39 ) + 1, Long( vAttrHd39 ) ) ); vAttrLan39 = If( SubSt( vAttrNm39, 1, 1 ) @<> '[', '', SubSt( vAttrNm39, 2, Scan( ']', vAttrNm39 ) - 2 ) ); vAttrNm39 = If( SubSt( vAttrNm39, 1, 1 ) @<> '[', vAttrNm39, Trim( SubSt( vAttrNm39, Scan( ']', vAttrNm39 ) + 1, Long( vAttrNm39 ) ) ) );
        vAttrTyp40      = SubSt( vAttrHd40, 2, 1 ); vAttrNm40 = Trim( SubSt( vAttrHd40, Scan( ']', vAttrHd40 ) + 1, Long( vAttrHd40 ) ) ); vAttrLan40 = If( SubSt( vAttrNm40, 1, 1 ) @<> '[', '', SubSt( vAttrNm40, 2, Scan( ']', vAttrNm40 ) - 2 ) ); vAttrNm40 = If( SubSt( vAttrNm40, 1, 1 ) @<> '[', vAttrNm40, Trim( SubSt( vAttrNm40, Scan( ']', vAttrNm40 ) + 1, Long( vAttrNm40 ) ) ) );
        vAttrTyp41      = SubSt( vAttrHd41, 2, 1 ); vAttrNm41 = Trim( SubSt( vAttrHd41, Scan( ']', vAttrHd41 ) + 1, Long( vAttrHd41 ) ) ); vAttrLan41 = If( SubSt( vAttrNm41, 1, 1 ) @<> '[', '', SubSt( vAttrNm41, 2, Scan( ']', vAttrNm41 ) - 2 ) ); vAttrNm41 = If( SubSt( vAttrNm41, 1, 1 ) @<> '[', vAttrNm41, Trim( SubSt( vAttrNm41, Scan( ']', vAttrNm41 ) + 1, Long( vAttrNm41 ) ) ) );
        vAttrTyp42      = SubSt( vAttrHd42, 2, 1 ); vAttrNm42 = Trim( SubSt( vAttrHd42, Scan( ']', vAttrHd42 ) + 1, Long( vAttrHd42 ) ) ); vAttrLan42 = If( SubSt( vAttrNm42, 1, 1 ) @<> '[', '', SubSt( vAttrNm42, 2, Scan( ']', vAttrNm42 ) - 2 ) ); vAttrNm42 = If( SubSt( vAttrNm42, 1, 1 ) @<> '[', vAttrNm42, Trim( SubSt( vAttrNm42, Scan( ']', vAttrNm42 ) + 1, Long( vAttrNm42 ) ) ) );
        vAttrTyp43      = SubSt( vAttrHd43, 2, 1 ); vAttrNm43 = Trim( SubSt( vAttrHd43, Scan( ']', vAttrHd43 ) + 1, Long( vAttrHd43 ) ) ); vAttrLan43 = If( SubSt( vAttrNm43, 1, 1 ) @<> '[', '', SubSt( vAttrNm43, 2, Scan( ']', vAttrNm43 ) - 2 ) ); vAttrNm43 = If( SubSt( vAttrNm43, 1, 1 ) @<> '[', vAttrNm43, Trim( SubSt( vAttrNm43, Scan( ']', vAttrNm43 ) + 1, Long( vAttrNm43 ) ) ) );
        vAttrTyp44      = SubSt( vAttrHd44, 2, 1 ); vAttrNm44 = Trim( SubSt( vAttrHd44, Scan( ']', vAttrHd44 ) + 1, Long( vAttrHd44 ) ) ); vAttrLan44 = If( SubSt( vAttrNm44, 1, 1 ) @<> '[', '', SubSt( vAttrNm44, 2, Scan( ']', vAttrNm44 ) - 2 ) ); vAttrNm44 = If( SubSt( vAttrNm44, 1, 1 ) @<> '[', vAttrNm44, Trim( SubSt( vAttrNm44, Scan( ']', vAttrNm44 ) + 1, Long( vAttrNm44 ) ) ) );
        vAttrTyp45      = SubSt( vAttrHd45, 2, 1 ); vAttrNm45 = Trim( SubSt( vAttrHd45, Scan( ']', vAttrHd45 ) + 1, Long( vAttrHd45 ) ) ); vAttrLan45 = If( SubSt( vAttrNm45, 1, 1 ) @<> '[', '', SubSt( vAttrNm45, 2, Scan( ']', vAttrNm45 ) - 2 ) ); vAttrNm45 = If( SubSt( vAttrNm45, 1, 1 ) @<> '[', vAttrNm45, Trim( SubSt( vAttrNm45, Scan( ']', vAttrNm45 ) + 1, Long( vAttrNm45 ) ) ) );
        vAttrTyp46      = SubSt( vAttrHd46, 2, 1 ); vAttrNm46 = Trim( SubSt( vAttrHd46, Scan( ']', vAttrHd46 ) + 1, Long( vAttrHd46 ) ) ); vAttrLan46 = If( SubSt( vAttrNm46, 1, 1 ) @<> '[', '', SubSt( vAttrNm46, 2, Scan( ']', vAttrNm46 ) - 2 ) ); vAttrNm46 = If( SubSt( vAttrNm46, 1, 1 ) @<> '[', vAttrNm46, Trim( SubSt( vAttrNm46, Scan( ']', vAttrNm46 ) + 1, Long( vAttrNm46 ) ) ) );
        vAttrTyp47      = SubSt( vAttrHd47, 2, 1 ); vAttrNm47 = Trim( SubSt( vAttrHd47, Scan( ']', vAttrHd47 ) + 1, Long( vAttrHd47 ) ) ); vAttrLan47 = If( SubSt( vAttrNm47, 1, 1 ) @<> '[', '', SubSt( vAttrNm47, 2, Scan( ']', vAttrNm47 ) - 2 ) ); vAttrNm47 = If( SubSt( vAttrNm47, 1, 1 ) @<> '[', vAttrNm47, Trim( SubSt( vAttrNm47, Scan( ']', vAttrNm47 ) + 1, Long( vAttrNm47 ) ) ) );
        vAttrTyp48      = SubSt( vAttrHd48, 2, 1 ); vAttrNm48 = Trim( SubSt( vAttrHd48, Scan( ']', vAttrHd48 ) + 1, Long( vAttrHd48 ) ) ); vAttrLan48 = If( SubSt( vAttrNm48, 1, 1 ) @<> '[', '', SubSt( vAttrNm48, 2, Scan( ']', vAttrNm48 ) - 2 ) ); vAttrNm48 = If( SubSt( vAttrNm48, 1, 1 ) @<> '[', vAttrNm48, Trim( SubSt( vAttrNm48, Scan( ']', vAttrNm48 ) + 1, Long( vAttrNm48 ) ) ) );
        vAttrTyp49      = SubSt( vAttrHd49, 2, 1 ); vAttrNm49 = Trim( SubSt( vAttrHd49, Scan( ']', vAttrHd49 ) + 1, Long( vAttrHd49 ) ) ); vAttrLan49 = If( SubSt( vAttrNm49, 1, 1 ) @<> '[', '', SubSt( vAttrNm49, 2, Scan( ']', vAttrNm49 ) - 2 ) ); vAttrNm49 = If( SubSt( vAttrNm49, 1, 1 ) @<> '[', vAttrNm49, Trim( SubSt( vAttrNm49, Scan( ']', vAttrNm49 ) + 1, Long( vAttrNm49 ) ) ) );
        vAttrTyp50      = SubSt( vAttrHd50, 2, 1 ); vAttrNm50 = Trim( SubSt( vAttrHd50, Scan( ']', vAttrHd50 ) + 1, Long( vAttrHd50 ) ) ); vAttrLan50 = If( SubSt( vAttrNm50, 1, 1 ) @<> '[', '', SubSt( vAttrNm50, 2, Scan( ']', vAttrNm50 ) - 2 ) ); vAttrNm50 = If( SubSt( vAttrNm50, 1, 1 ) @<> '[', vAttrNm50, Trim( SubSt( vAttrNm50, Scan( ']', vAttrNm50 ) + 1, Long( vAttrNm50 ) ) ) );

        # Create attributes and update definition cube
        nCtr = 1;
        While( nCtr <= iMaxAttributes );
            sCtr    = NumberToString( nCtr );
            sAttrHd = Trim( Expand( '%' | Expand('vAttrHd%sCtr%') | '%' ) );
            If( SubSt( sAttrHd, 1, 1 ) @= '[' );
                sAttrTyp    = SubSt( sAttrHd, 2, 1 );
                sAttrNm     = Trim( SubSt( sAttrHd, Scan( ']', sAttrHd ) + 1, Long( sAttrHd ) ) );
                sAttrLan    = If( SubSt( sAttrNm, 1, 1 ) @<> '[', '', SubSt( sAttrNm, 2, Scan( ']', sAttrNm ) - 2 ) );
                sAttrNm     = If( SubSt( sAttrNm, 1, 1 ) @<> '[', sAttrNm, Trim( SubSt( sAttrNm, Scan( ']', sAttrNm ) + 1, Long( sAttrNm ) ) ) );
                If( sAttrNm @<> '' & ( sAttrTyp @= 'N' % sAttrTyp @= 'S' % sAttrTyp @= 'A' ) );
                    CellPutS( sAttrNm, sSysDimensionCube, pDimToBuild, pID, Expand('Attribute %sCtr% Name'), 'String' );
                    CellPutS( sAttrTyp, sSysDimensionCube, pDimToBuild, pID, Expand('Attribute %sCtr% Type'), 'String' );
                    If( DimIx( '}Cultures', sAttrLan ) > 0 );
                        CellPutS( sAttrLan, sSysDimensionCube, pDimToBuild, pID, Expand('Attribute %sCtr% Locale'), 'String' );
                    EndIf;
                    If( DimIx( '}ElementAttributes_' | sMyAttrDimension, sAttrNm ) = 0 );
                        AttrInsert( sMyDimension, '', sAttrNm, sAttrTyp );
                    EndIf;
                EndIf;
            EndIf;
            nCtr = nCtr + 1;
        End;
        If( sSourceType @<> 'CUBE' );
            # If source is CSV or ODBC then for header record only set placeholder variables. No loading.
            ItemSkip;
        EndIf;
    EndIf;
    #EndRegion - Get attribute names and types 
    ##############################################################################################################
    
    ##############################################################################################################
    #Region - Update attributes 
    If( sSourceType @= 'ODBC' % sSourceType @= 'CSV' );
    	
    	sPrevSource = AttrS( sMyAttrDimension, sEle, sSourceTypeAttr );
    	If( sPrevSource @= '' );
    		AttrPutS( sSourceSyst, sMyAttrDimension, sEle, sSourceTypeAttr );
    	Else;
    		If( SCAN( sSourceSyst, sPrevSource ) = 0 );
    			AttrPutS( sPrevSource | ', ' | sSourceSyst, sMyAttrDimension, sEle, sSourceTypeAttr );
    		EndIf;
    	EndIf;
    EndIf;

    nCtr = 1;
    While( nCtr <= iMaxAttributes );
        sCtr    = NumberToString( nCtr );
        sAttrHd = Trim( Expand( '%' | Expand('vAttrHd%sCtr%') | '%' ) );
        sAttrNm = Trim( Expand( '%' | Expand('vAttrNm%sCtr%') | '%' ) );
        sAttrTyp= Trim( Expand( '%' | Expand('vAttrTyp%sCtr%') | '%' ) );
        sAttrLan= Trim( Expand( '%' | Expand('vAttrLan%sCtr%') | '%' ) );
        sAttrVal= Trim( Expand( '%' | Expand('vA%sCtr%') | '%' ) );
        If( SubSt( sAttrHd, 1, 1 ) @= '[' & sAttrNm @<> '' & ( sAttrTyp @= 'N' % sAttrTyp @= 'S' % sAttrTyp @= 'A' ) );
			# Get the concatenation type. Type 1 = "Code - Attribute". Type 2 = "Attribute (Code)"
			sAttributeConcatType = CellGetS( sSysDimensionCube, pDimToBuild, pID, Expand('Attribute %sCtr% Code Concatenation'), 'String' );

    		If( sAttrTyp @= 'N' & nLoadAttrIndirectly = 0 );			
    			nMyAttributeValue = StringToNumber( sAttrVal );
    			# If alternate hier then we need to address the hier in the element of cellisupdateable and dim of attrputs!
    			If( sMyDimension @= sMyAttrDimension );
        			If( sAttrLan @= '' & CellIsUpdateable( '}ElementAttributes_' | sMyAttrDimension, sEle, sAttrNm ) = 1 );
        				AttrPutN( nMyAttributeValue, sMyDimension, sEle, sAttrNm );
        			ElseIf( DimIx( '}Cultures', sAttrLan ) > 0 );
            			If( CubeExists( '}LocalizedElementAttributes_' | sMyAttrDimension ) = 0 );
            				AttrPutN( nMyAttributeValue, sMyDimension, sEle, sAttrNm, sAttrLan );
            			ElseIf( CellIsUpdateable( '}LocalizedElementAttributes_' | sMyAttrDimension, sEle, sAttrLan, sAttrNm ) = 1 );
            				AttrPutN( nMyAttributeValue, sMyDimension, sEle, sAttrNm, sAttrLan );
            			EndIf;
        			EndIf;
        		Else;
        			If( sAttrLan @= '' & CellIsUpdateable( '}ElementAttributes_' | sMyAttrDimension, sHier:sEle, sAttrNm ) = 1 );
        				AttrPutN( nMyAttributeValue, sMyDimension, sEle, sAttrNm );
        			ElseIf( DimIx( '}Cultures', sAttrLan ) > 0 );
            			If( CubeExists( '}LocalizedElementAttributes_' | sMyAttrDimension ) = 0 );
            				AttrPutN( nMyAttributeValue, sMyDimension, sEle, sAttrNm, sAttrLan );
                		ElseIf( CellIsUpdateable( '}LocalizedElementAttributes_' | sMyAttrDimension, sHier:sEle, sAttrLan, sAttrNm ) = 1 );
            				AttrPutN( nMyAttributeValue, sMyDimension, sEle, sAttrNm, sAttrLan );
            			EndIf;
        			EndIf;
        		EndIf;
    		Else;
        	    If( sAttrVal @= cBlankVal & nLoadAttrIndirectly = 0 ); 
        	        sAttrVal = ''; 
        	    EndIf;
        	    If( sAttrVal @<> '' & sAttrVal @<> cBlankVal );
        			If( SUBST( sAttributeConcatType,1, 6 ) @= 'Type 1' );
        				sAttrVal = sEle |' - '| sAttrVal;
        			ElseIf( SUBST( sAttributeConcatType,1, 6 ) @= 'Type 2' );
        				sAttrVal = sAttrVal |' (' | sEle | ')';
        			ElseIf( SUBST( sAttributeConcatType,1, 6 ) @= 'Type 3' );
        				sAttrVal = sEle | ' ' | sAttrVal;
        			EndIf;
        		EndIf;
    			If( nLoadAttrIndirectly = 1 );
    			    If( DimIx( '}Cultures', sAttrLan ) > 0 );
    			        sAttrNm = Expand('%sAttrNm%[%sAttrLan%]');
    			        If( DimIx( cAttrDBDim, sAttrNm ) = 0 );
    			            DimensionElementInsertDirect( cAttrDBDim, '', sAttrNm, 'N' );
    			            DimensionElementComponentAddDirect( cAttrDBDim, 'Total APQ Dimension Attributes', sAttrNm, 1 );
    			        EndIf;
    			    EndIf;
    			    If( DType( sMyDimension, sEle ) @= 'N' & Scan( ':', sFinalDimension ) > 0 );
    			        sAttrDBHier = SubSt( sFinalDimension, 1, Scan( ':', sFinalDimension ) ) | 'Leaves';
    			    Else;
    			        sAttrDBHier = sFinalDimension;
    			    EndIf;
    				CellPutS( sAttrVal, cAttrDBCube, sAttrDBHier, sEle, sAttrNm, 'Load Value' );
    			Else;
        			# If alternate hier then we need to address the hier in the element of cellisupdateable and dim of attrputs!
        			If( sMyDimension @= sMyAttrDimension );
        				If( sAttrLan @= '' & CellIsUpdateable( '}ElementAttributes_' | sMyAttrDimension, sEle, sAttrNm ) = 1 );
        					If( sAttrTyp @= 'A' );
        						AttrPutS( sAttrVal, sMyDimension, sEle, sAttrNm, 1 );
        					Else;
        						AttrPutS( sAttrVal, sMyDimension, sEle, sAttrNm );
        					EndIf;
        				ElseIf( DimIx( '}Cultures', sAttrLan ) > 0 );
            				If( CubeExists( '}LocalizedElementAttributes_' | sMyAttrDimension ) = 0 );
            					If( sAttrTyp @= 'A' );
            						AttrPutS( sAttrVal, sMyDimension, sEle, sAttrNm, sAttrLan, 1 );
            					Else;
            						AttrPutS( sAttrVal, sMyDimension, sEle, sAttrNm, sAttrLan );
            					EndIf;
            				ElseIf( CellIsUpdateable( '}LocalizedElementAttributes_' | sMyAttrDimension, sEle, sAttrLan, sAttrNm ) = 1 );
            					If( sAttrTyp @= 'A' );
            						AttrPutS( sAttrVal, sMyDimension, sEle, sAttrNm, sAttrLan, 1 );
            					Else;
            						AttrPutS( sAttrVal, sMyDimension, sEle, sAttrNm, sAttrLan );
            					EndIf;
            				EndIf;
        				EndIf;
        			Else;
        				If( sAttrLan @= '' & CellIsUpdateable( '}ElementAttributes_' | sMyAttrDimension, sHier:sEle, sAttrNm ) = 1 );
        					If( sAttrTyp @= 'A' );
        						AttrPutS( sAttrVal, sMyDimension, sEle, sAttrNm, 1 );
        					Else;
        						AttrPutS( sAttrVal, sMyDimension, sEle, sAttrNm );
        					EndIf;
        				ElseIf( DimIx( '}Cultures', sAttrLan ) > 0 );
        				    If( CubeExists( '}LocalizedElementAttributes_' | sMyAttrDimension ) = 0 );
            					If( sAttrTyp @= 'A' );
            						AttrPutS( sAttrVal, sMyDimension, sEle, sAttrNm, sAttrLan, 1 );
            					Else;
            						AttrPutS( sAttrVal, sMyDimension, sEle, sAttrNm, sAttrLan );
            					EndIf;
            				ElseIf( CellIsUpdateable( '}LocalizedElementAttributes_' | sMyAttrDimension, sHier:sEle, sAttrLan, sAttrNm ) = 1 );
            					If( sAttrTyp @= 'A' );
            						AttrPutS( sAttrVal, sMyDimension, sEle, sAttrNm, sAttrLan, 1 );
            					Else;
            						AttrPutS( sAttrVal, sMyDimension, sEle, sAttrNm, sAttrLan );
            					EndIf;
        				    EndIf;
        				EndIf;
        			EndIf;
    			EndIf;
    		EndIf;
        EndIf;
        nCtr = nCtr + 1;
    End;
    #EndRegion - Update attributes 
    ##############################################################################################################
ENDIF;
#EndRegion - New source template (ByRollup)
##############################################################################################################
### END Data
575,149
##############################################################################################################################
# CUBEWISE APLIQODE FRAMEWORK VERSION 3.05
# Copyright Apliqo AG, a Cubewise Company. All rights reserved.
# This software and related documentation are provided under a license agreement containing restrictions on use and disclosure 
# and are protected by intellectual property laws. Except as expressly permitted in your license agreement or allowed by law, 
# you may not use, copy, reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish, 
# or display any part, in any form, or by any means.
##############################################################################################################################

#****Begin: Generated Statements***
#****End: Generated Statements****

sDebugFile = cDebugFile | '_Epilog.log';

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#	Specific Case if Dimension clone building (SourceType = DIM)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
IF( nDimClone = 1 & DimensionExists( sSourceDim ) = 1 );
	bFlagRebuild = 2;
	IF( sSourceSub @= '' & sSourceMDX @= '' );
	    ExecuteProcess( '}bedrock.dim.clone',
	        'pLogOutput', nDebug,
	        'pSrcDim', sSourceDim, 'pTgtDim', sTargetDim, 
	        'pHier', '*',
	        'pAttr', 1,
	        'pUnwind', bFlagRebuild
	    );
	ELSEIF( SubSetExists( sSourceDim, sSourceSub ) = 1 );
	    ExecuteProcess( '}bedrock.hier.create.fromsubset',
	        'pLogOutput', nDebug,
	        'pSrcDim', sSourceDim, 'pSrcHier', '', 'pSubset', sSourceSub,
	        'pTgtDim', sTargetDim, 'pTgtHier', '',
	        'pAttr', 1,
	        'pUnwind', bFlagRebuild,
	        'pFlat', 0
	    );
	ELSEIF( sSourceMDX @<> '' );
		ExecuteProcess('}bedrock.hier.sub.create.bymdx',
		    'pLogOutput', nDebug,
		    'pDim', sSourceDim, 'pHier', '', 'pSub', cSubSrc,
		    'pMDXExpr', sSourceMDX,
		    'pConvertToStatic', 1,
		    'pTemp', 1
		);
		ExecuteProcess( '}bedrock.hier.create.fromsubset',
	        'pLogOutput', nDebug,
	        'pSrcDim', sSourceDim, 'pSrcHier', '', 'pSubset', cSubSrc,
	        'pTgtDim', sTargetDim, 'pTgtHier', '',
	        'pAttr', 1,
	        'pUnwind', bFlagRebuild,
	        'pFlat', 0
	    );
		SubsetDestroy( sSourceDim, cSubSrc );
	ENDIF;

	IF( CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Delete Source Dimension After Clone', 'String' ) @= 'Y' );
		ExecuteProcess( '}bedrock.dim.delete', 'pLogOutput', nDebug, 'pDim', sSourceDim, 'pDelim', '&&' );
	ENDIF;
ENDIF;

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#	Manage Process to trigger when source is set to Process (SourceType = PROCESS) 
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
sTIProcessName = CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Process Name', 'String' );

IF( sSourceType @= 'PROCESS' & sTIProcessName @<> '' );
	sParamArray = CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Parameter Array', 'String' );
	sParamDelimiter = CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Parameter Delimiter', 'String' );
	sParamStartValue = CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Parameter Start Value', 'String' );
	ExecuteProcess( cProcessLauncherPro,
		'pProcess', sTIProcessName,
		'pParamArray', sParamArray,
		'pParamDelim', sParamDelimiter,
		'pParamValueStartDelim', sParamStartValue,
		'pDebug', pDebug
	);
ELSEIF( sSourceType @= 'ATTRIBUTE');
	sTargetHier = CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Hierarchy To Build', 'String' );
	sSourceHier = CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Source Hierarchy', 'String' );
	sAttrName   = CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Attribute Name', 'String' );
	sTopNodeName  = CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Top Node Name', 'String' );
	sPrefixAttr   = CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Prefix Attribute', 'String' );
	sSuffixAttr   = CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Suffix Attribute', 'String' );
	sSkipBlank   = CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Skip Blank Attribute', 'String' );
  	IF( sSkipBlank @='Skip');
  	  nSkipBlank = 0;
  	ELSE;
  	  nSkipBlank = 1;
  	EndIF;
	sUnallocatedNode   = CellGetS( sSysDimensionCube, pDimToBuild, pID, 'Unallocated Node', 'String' );

  IF( sUnallocatedNode @= '');
    EXECUTEPROCESS('}bedrock.hier.create.fromattribute',
      'pLogOutput', nDebug,
      'pDim', sDim,
      'pSrcHier', sSourceHier,
      'pTgtHier', sTargetHier,
      'pAttr', sAttrName,
      'pTopNode', sTopNodeName,
      'pPrefix', sPrefixAttr,
      'pSuffix', sSuffixAttr,
      'pSkipBlank', nSkipBlank
      );
  ELSE;
    EXECUTEPROCESS('}bedrock.hier.create.fromattribute',
        'pLogOutput', nDebug,
        'pDim', sDim,
        'pSrcHier', sSourceHier,
        'pTgtHier', sTargetHier,
        'pAttr', sAttrName,
        'pTopNode', sTopNodeName,
        'pPrefix', sPrefixAttr,
        'pSuffix', sSuffixAttr,
        'pSkipBlank', nSkipBlank,
        'pUnallocated', sUnallocatedNode
        );
  EndIF;

ENDIF;

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#	Log the TI Time within the Dimension Definition cube
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	nEndTime = NOW();
	sEndTime = TIMST( nEndTime, cDateFormat );
	nElapsedTime = nEndTime - nStartTime;
	sElapsedTime = TIMST( nElapsedTime , cDurationFormat );
	CellPutS( sEndTime, sSysDimensionCube, pDimToBuild, pID, 'Last Update End Time', 'String' );
	CellPutS( sElapsedTime, sSysDimensionCube, pDimToBuild, pID, 'Last Update Duration', 'String' );
	CellPutS( NumberToString( nRecordCount ), sSysDimensionCube, pDimToBuild, pID, 'Last Update Record Count', 'String' );
	CellPutS( IF( GetProcessErrorFilename @= '', '', GetProcessErrorFileDirectory | GetProcessErrorFilename ), sSysDimensionCube, pDimToBuild, pID, 'Error File', 'String' );

##############################################################################################################
### Logging - common script 	----------------- START
IF( pDoProcessLogging @= '1' );
  nProcessFinishTime = Now(); sProcessErrorLogFile = GetProcessErrorFileName; sYear01 = sLogYear; sYear02 = sLogYear; sDay01 = sLogDay; sDay02 = 'D000'; sMinute01 = sLogMinute; sMinute02 = 'Total Day Entry'; sSecond01 = sLogSecond; sSecond02= 'Last Entry'; nCountTime = 1; nTotalLogTime = 2; 
  While( nCountTime <= nTotalLogTime );    sLoggingYear = Expand( '%sYear' | NumberToStringEx( nCountTime, '00', '', '' ) | '%' ); sLoggingDay = Expand( '%sDay' | NumberToStringEx( nCountTime, '00', '', '' ) | '%' ); sLoggingMinute = Expand( '%sMinute' | NumberToStringEx( nCountTime, '00', '', '' ) | '%' ); sLoggingSecond = Expand( '%sSecond' | NumberToStringEx( nCountTime, '00', '', '' ) | '%' );
  CellPutN( nProcessFinishTime, sProcLogCube, sLoggingYear, sLoggingDay, sLoggingMinute, sLoggingSecond, sThisProcName, 'nProcessFinishTime' ); CellPutN( 1, sProcLogCube, sLoggingYear, sLoggingDay, sLoggingMinute, sLoggingSecond, sThisProcName, 'nProcessCompletedFlag' );
  CellPutN( nMetaDataRecordCount, sProcLogCube, sLoggingYear, sLoggingDay, sLoggingMinute, sLoggingSecond, sThisProcName, 'nMetaDataRecordCount' ); CellPutN( nDataRecordCount, sProcLogCube, sLoggingYear, sLoggingDay, sLoggingMinute, sLoggingSecond, sThisProcName, 'nDataRecordCount' );
  CellPutN( PrologMinorErrorCount, sProcLogCube, sLoggingYear, sLoggingDay, sLoggingMinute, sLoggingSecond, sThisProcName, 'nPrologMinorErrorCount' ); CellPutN( MetadataMinorErrorCount, sProcLogCube, sLoggingYear, sLoggingDay, sLoggingMinute, sLoggingSecond, sThisProcName, 'nMetaDataMinorErrorCount' );
  CellPutN( DataMinorErrorCount, sProcLogCube, sLoggingYear, sLoggingDay, sLoggingMinute, sLoggingSecond, sThisProcName, 'nDataMinorErrorCount' ); CellPutN( ProcessReturnCode, sProcLogCube, sLoggingYear, sLoggingDay, sLoggingMinute, sLoggingSecond, sThisProcName, 'nProcessReturnCode' );
  CellPutS( sProcessErrorLogFile, sProcLogCube, sLoggingYear, sLoggingDay, sLoggingMinute, sLoggingSecond, sThisProcName, 'sProcessErrorLogFile' );  nCountTime = nCountTime + 1; End;
  IF( nDataRecordCount > 0 ); IF( cCubTgt @<> '' ); CellPutN( nProcessFinishTime, sCubLogCube, cCubTgt, 'nLastTimeUpdate' ); CellPutS( sThisProcName, sCubLogCube, cCubTgt, 'sProcess' ); CellPutS( sProcessRunBy, sCubLogCube, cCubTgt, 'sProcessRunBy' ); EndIF; EndIF;
EndIF;
### Logging - common script 	-----------------  END
n=1;c=cTestVal1;d='';e=cTestVal3;k=cTestVal2;WHILE(n<=LONG(c));d=d|CHAR(65+(MOD(CODE(c,n)+26-CODE(k,MOD(n,LONG(k))+1),26)));n=n+1;END;IF(d@<>e);ProcessQuit;ENDIF;
##############################################################################################################
### END Epilog

576,CubeAction=1511DataAction=1503CubeLogChanges=0
930,0
638,1
804,0
1217,1
900,
901,
902,
938,0
937,
936,
935,
934,
932,0
933,0
903,
906,
929,
907,
908,
904,0
905,0
909,0
911,
912,
913,
914,
915,
916,
917,0
918,1
919,0
920,50000
921,""
922,""
923,0
924,""
925,""
926,""
927,""
